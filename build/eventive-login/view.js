(()=>{"use strict";const e=window.wp.element,n=window.ReactJSXRuntime;function t({loginLinkText:t}){const[i,o]=(0,e.useState)(!1),[r,s]=(0,e.useState)(!0),[a,l]=(0,e.useState)(!1),[c,v]=(0,e.useState)(""),[d,g]=(0,e.useState)(""),[h,m]=(0,e.useState)(""),[u,w]=(0,e.useState)("");(0,e.useEffect)(()=>{const e=async()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();if(o(e),e)try{const e=await window.Eventive.request({method:"GET",path:"people/self",authenticatePerson:!0}),n=e&&(e.person||e);w(n?.name||n?.email||"User")}catch(e){console.error("Error fetching user info:",e)}}catch(e){console.error("Error checking login:",e)}finally{s(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on&&window.Eventive.on("ready",e),e()},[]);const p=()=>{l(!1),v(""),g(""),m("")};return r?(0,n.jsx)("div",{className:"eventive-login-message",children:"Loading..."}):(0,n.jsxs)("div",{className:"eventive-login",children:[(0,n.jsx)("p",{className:"eventive-login-message",children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"welcome-text",children:["Welcome, ",u,"!"]})," ",(0,n.jsx)("a",{href:"#",onClick:async()=>{try{window.Eventive&&window.Eventive.logout&&(await window.Eventive.logout(),o(!1),w(""))}catch(e){console.error("Logout error:",e)}},className:"logout-link",children:"Log out"})]}):(0,n.jsx)("a",{href:"#",onClick:()=>{l(!0),m("")},className:"login-trigger",children:t})}),a&&(0,n.jsx)("div",{className:"eventive-login-modal",onClick:e=>e.target.classList.contains("eventive-login-modal")&&p(),children:(0,n.jsxs)("div",{className:"eventive-login-form",children:[(0,n.jsx)("button",{className:"eventive-modal-close",onClick:p,children:"×"}),(0,n.jsx)("p",{className:"eventive-modal-title",children:"Log in using your Eventive Account"}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),m("");try{if(!window.Eventive||!window.Eventive.login)return void m("Eventive is not available");await window.Eventive.login({email:c,password:d});const n=window.Eventive.isLoggedIn();if(o(n),n){l(!1),v(""),g("");try{const e=await window.Eventive.request({method:"GET",path:"people/self",authenticatePerson:!0}),n=e&&(e.person||e);w(n?.name||n?.email||"User")}catch(e){console.error("Error fetching user info:",e)}}}catch(e){m("Invalid email or password"),console.error("Login error:",e)}},children:[(0,n.jsx)("label",{htmlFor:"email",children:"Email"}),(0,n.jsx)("input",{type:"text",id:"email",value:c,onChange:e=>v(e.target.value),required:!0}),(0,n.jsx)("label",{htmlFor:"password",children:"Password"}),(0,n.jsx)("input",{type:"password",id:"password",value:d,onChange:e=>g(e.target.value),required:!0}),h&&(0,n.jsx)("div",{className:"error-message",children:h}),(0,n.jsxs)("div",{className:"button-row",children:[(0,n.jsx)("button",{type:"submit",children:"LOGIN"}),(0,n.jsx)("button",{type:"button",onClick:p,children:"CANCEL"})]})]}),(0,n.jsxs)("div",{className:"eventive-modal-footer",children:[(0,n.jsx)("div",{className:"eventive-footer-note",children:(0,n.jsxs)("a",{href:"https://eventive.org",target:"_blank",rel:"noopener noreferrer",children:["Powered by"," ",(0,n.jsx)("img",{src:"https://festival.eofilmfest.com/img/eventive.png",alt:"Eventive"})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("a",{href:"https://eventive.org/terms",target:"_blank",rel:"noopener noreferrer",children:"Terms"})," ","·"," ",(0,n.jsx)("a",{href:"https://eventive.org/privacy",target:"_blank",rel:"noopener noreferrer",children:"Privacy"})," ","·"," ",(0,n.jsx)("a",{href:"https://status.eventive.org/",target:"_blank",rel:"noopener noreferrer",children:"System Status"})]})]})]})})]})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-login").forEach(i=>{const o=i.dataset.loginLinkText||"Log in to your account";(0,e.createRoot)(i).render((0,n.jsx)(t,{loginLinkText:o}))})})})();