(()=>{"use strict";function t(t){return(t||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-film-details").forEach(e=>{let i=e.getAttribute("data-film-id")||"";const n=new URLSearchParams(window.location.search).get("film-id");if(n&&(i=n),!i)return void(e.innerHTML='<div class="error-message">Please provide a valid film ID.</div>');const r="false"!==e.getAttribute("data-show-events"),a="true"===e.getAttribute("data-show-details"),s="true"===e.getAttribute("data-show-tags"),o="false"!==e.getAttribute("data-exclude-virtual"),l=(window.EventiveBlockData,window.EventiveBlockData,window.EventiveBlockData?.eventBucket||""),d=i=>{const n=(i.tags||[]).map(e=>{const i=(n=e.color||"#ccc")?(3===(n=String(n).replace("#","")).length&&(n=n.split("").map(t=>t+t).join("")),(299*(parseInt(n.substr(0,2),16)||0)+587*(parseInt(n.substr(2,2),16)||0)+114*(parseInt(n.substr(4,2),16)||0))/1e3>=128?"#000":"#fff"):"#000";var n;return`<span class="film-tag-pill" style="background-color:${e.color||"#ccc"};color:${i};">${t(e.name)}</span>`}).join(""),o=i.credits||{},l=Object.keys(o).map(e=>{const i=o[e];return i?`<div><strong>${t(e.replace(/_/g," ").toUpperCase())}:</strong> ${t(String(i))}</div>`:""}).join(""),d=i.trailer_url?`<button class="film-watch-button" data-trailer-url="${t(i.trailer_url)}" style="width:100%;max-width:400px;margin-top:8px;padding:10px 0;background:#ff3b3b;color:#fff;font-weight:600;border:none;border-radius:4px;cursor:pointer;">▶ Watch Trailer</button>`:"";e.innerHTML=`\n\t\t\t\t<div class="hero-section" ${i.cover_image?`style="background-image:url('${t(i.cover_image)}');"`:""}>\n\t\t\t\t\t<div class="film-images" style="display:flex;flex-direction:column;align-items:center;">\n\t\t\t\t\t\t<img class="film-poster" src="${t(i.poster_image||"")}" alt="${t(i.name||"Film")}">\n\t\t\t\t\t\t${d}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="film-details">\n\t\t\t\t\t<h2 class="film-title">${t(i.name||"")}</h2>\n\t\t\t\t\t${a?`\n\t\t\t\t\t\t<div class="film-info">\n\t\t\t\t\t\t\t<div><strong>Director:</strong> ${t(i.credits&&i.credits.director||"Unknown")}</div>\n\t\t\t\t\t\t\t<div><strong>Runtime:</strong> ${t(String(i.details&&i.details.runtime||"N/A"))} minutes</div>\n\t\t\t\t\t\t\t<div><strong>Year:</strong> ${t(String(i.details&&i.details.year||"N/A"))}</div>\n\t\t\t\t\t\t\t<div><strong>Language:</strong> ${t(String(i.details&&i.details.language||"N/A"))}</div>\n\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t<div class="film-description">${i.description||"No description available."}</div>\n\t\t\t\t\t${s?`<div class="film-tags">${n}</div>`:""}\n\t\t\t\t\t${a?`<div class="film-credits"><h3>Credits</h3>${l}</div>`:""}\n\t\t\t\t\t${r?'<div class="film-events"></div>':""}\n\t\t\t\t</div>`,(t=>{const e=t.querySelector(".film-watch-button");if(!e)return;let i,n=document.querySelector(".eventive-trailer-modal");if(n)i=n.querySelector(".eventive-trailer-iframe");else{n=document.createElement("div"),n.className="eventive-trailer-modal",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.style.display="none",n.innerHTML='\n\t\t\t\t\t<div class="eventive-trailer-backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);"></div>\n\t\t\t\t\t<div class="eventive-trailer-dialog" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#000;border-radius:8px;display:block;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.5);width:min(90vw,960px);">\n\t\t\t\t\t\t<button class="eventive-trailer-close" aria-label="Close trailer" title="Close" style="position:absolute;top:6px;right:8px;border:0;background:rgba(0,0,0,0.4);color:#fff;font-size:26px;line-height:1;padding:8px 12px;border-radius:6px;cursor:pointer;z-index:2">×</button>\n\t\t\t\t\t\t<div class="eventive-trailer-embed" style="position:relative;padding-top:56.25%;width:100%;">\n\t\t\t\t\t\t\t<iframe class="eventive-trailer-iframe" src="" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;border:0"></iframe>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>',document.body.appendChild(n),n.style.zIndex="10000",i=n.querySelector(".eventive-trailer-iframe");const t=()=>{i.src="",n.style.display="none",document.documentElement.style.overflow=""};n.querySelector(".eventive-trailer-close").addEventListener("click",t),n.querySelector(".eventive-trailer-backdrop").addEventListener("click",t),n.addEventListener("click",e=>{const i=n.querySelector(".eventive-trailer-dialog");i&&!i.contains(e.target)&&t()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&"block"===n.style.display&&t()})}e.addEventListener("click",t=>{t.preventDefault();const r=function(t){try{const e=new URL(t),i=e.hostname.replace(/^www\./,"").toLowerCase();if("youtu.be"===i){const t=(e.pathname.split("/")[1]||"").trim();return t?`https://www.youtube.com/embed/${t}?autoplay=1&rel=0&modestbranding=1`:null}if(i.endsWith("youtube.com")){const t=e.searchParams.get("v")||(e.pathname.startsWith("/shorts/")?e.pathname.split("/")[2]:"");return t?`https://www.youtube.com/embed/${t}?autoplay=1&rel=0&modestbranding=1`:null}if(i.endsWith("vimeo.com")){const t=e.pathname.split("/").filter(Boolean),n="player.vimeo.com"===i?"video"===t[1]?t[2]:t[1]:t[0];return n?`https://player.vimeo.com/video/${n}?autoplay=1`:null}return null}catch(t){return null}}(e.getAttribute("data-trailer-url")||"");r?(i.src=r,n.style.display="block",document.documentElement.style.overflow="hidden"):console.warn("Unsupported trailer URL")})})(e)};(()=>{const n=()=>{window.Eventive.request({method:"GET",path:`films/${i}`,authenticatePerson:!1}).then(n=>(d(n),r?window.Eventive.request({method:"GET",path:`event_buckets/${l}/films/${i}/events`,authenticatePerson:!1}).then(i=>{let n=[];Array.isArray(i?.events)?n=i.events:Array.isArray(i)&&(n=i);const r=new Date,a=n.filter(t=>t&&t.start_time&&!isNaN(new Date(t.start_time))&&new Date(t.start_time)>r).filter(t=>!o||!t.is_virtual);let s=[];o||(s=n.filter(t=>t&&!0===t.is_virtual&&!1===t.is_dated&&(!t.start_time||isNaN(new Date(t.start_time)))));const l=a.concat(s).sort((t,e)=>{const i=t&&t.start_time&&!isNaN(new Date(t.start_time)),n=e&&e.start_time&&!isNaN(new Date(e.start_time));return i&&n?new Date(t.start_time)-new Date(e.start_time):i&&!n?-1:!i&&n?1:0}),d=e.querySelector(".film-events");if(!d)return;if(!l.length)return d.innerHTML="<div>Scheduled showtime coming soon!</div>",void(window.Eventive?.rebuild&&window.Eventive.rebuild());const v={};l.forEach(t=>{if(!t)return;const e=t.start_time&&!isNaN(new Date(t.start_time)),i=!0===t.is_virtual&&!1===t.is_dated&&!e,n=t.venue&&(t.venue.name||t.venue.display_name||t.venue.slug)||(t.is_virtual?"Virtual":"TBA"),r=e?new Date(t.start_time):null;let a,s,o;if(i)a="virtual_anytime::virtual",s=new Date(864e13),o="ON-DEMAND";else{if(!r)return;a=r.toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})+"::"+(t.venue&&t.venue.id||(t.is_virtual?"virtual":"tba")),s=r,o=r.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}).toUpperCase()}v[a]||(v[a]={date:s,dateStr:o,venueName:n,isUndatedVirtual:i,items:[]}),v[a].items.push({id:t.id||"",dt:r,tz:t.timezone||t.venue&&t.venue.timezone||void 0,venueName:n,isUndatedVirtual:i})});const c=Object.values(v).sort((t,e)=>t.date-e.date).map(t=>(t.items.sort((t,e)=>t.dt-e.dt),t)).map(e=>{const i=e.items.map(e=>{const i=e.dt?e.dt.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",timeZone:e.tz}).toLowerCase():"on demand";return`\n\t\t\t\t\t\t\t\t\t<div class="eventive-showtime-row" style="display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;padding:6px 0;">\n\t\t\t\t\t\t\t\t\t\t<span class="eventive-showtime-time" style="font-weight:600;white-space:nowrap;">${i}</span>\n\t\t\t\t\t\t\t\t\t\t<span class="eventive-showtime-venue" style="opacity:.85;">${t(e.venueName)}</span>\n\t\t\t\t\t\t\t\t\t\t<div class="eventive-showtime-btn"><div class="eventive-button" data-event="${e.id}" data-label="${i}"></div></div>\n\t\t\t\t\t\t\t\t\t</div>`}).join("");return`\n\t\t\t\t\t\t\t<div class="eventive-screening" style="padding:12px 0;border-top:1px solid rgba(0,0,0,0.08);">\n\t\t\t\t\t\t\t\t<div class="eventive-screening__header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:6px;">\n\t\t\t\t\t\t\t\t\t<div class="eventive-screening__datetime" style="font-weight:700;">${e.dateStr}</div>\n\t\t\t\t\t\t\t\t\t<div class="eventive-screening__venue" style="opacity:0.85;">${t(e.venueName)}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="eventive-screening__items">${i}</div>\n\t\t\t\t\t\t\t</div>`}).join("");d.innerHTML=`<h3 class="eventive-events-title">Upcoming Events</h3><div class="eventive-events-list">${c}</div>`,window.Eventive?.rebuild&&window.Eventive.rebuild()}).catch(t=>{console.error("[eventive-film-details] Error fetching events:",t);const i=e.querySelector(".film-events");i&&(i.innerHTML="<div>Error loading events for this film.</div>")}):Promise.resolve())).catch(t=>{console.error("[eventive-film-details] Error fetching film:",t),e.innerHTML="<div>Error loading film details.</div>"})};window.Eventive&&window.Eventive._ready?n():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",n):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?n():(console.error("[eventive-film-details] Eventive API not available"),e.innerHTML="<div>Error loading film details.</div>")},1e3)})()})})})();