(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(e){let t=e.toLowerCase();return t=t.replace(/&/g," and "),t=t.replace(/[^a-z0-9]+/g," "),t=t.trim().replace(/\s+/g," "),t}function s(e){const t={},n=[e];for(;n.length>0;){const e=n.pop();Array.isArray(e)?e.forEach(e=>{"object"==typeof e&&null!==e&&n.push(e)}):"object"==typeof e&&null!==e&&(e.tags&&Array.isArray(e.tags)&&e.tags.forEach(e=>{e&&e.id&&(t[String(e.id)]=!0)}),Object.values(e).forEach(e=>{"object"==typeof e&&null!==e&&n.push(e)}))}return t}const a=({tag:e,isActive:n,onClick:s,resetUrl:a})=>{const i=function(e){const t=e.replace("#","");return 6===t.length?(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>150?"#000000":"#ffffff":"#000000"}(e.color),r=n?"is-active":"";return(0,t.jsx)("span",{className:`tag-label ${r}`,style:{backgroundColor:e.color,color:i},children:(0,t.jsx)("a",{href:e.id?`${a}${a.includes("?")?"&":"?"}tag-id=${e.id}`:a,className:"external-tag-filter","data-tag-id":e.id||"",style:{color:i},onClick:t=>{t.preventDefault(),s(e.id)},children:e.name})})},i=({view:i,display:r,hideEmpty:o,excludeTags:c})=>{const[l,d]=(0,e.useState)([]),[u,g]=(0,e.useState)(!0),[v,p]=(0,e.useState)(null),[h,f]=(0,e.useState)(""),[w,m]=(0,e.useState)(null);(0,e.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("tag-id")||"";f(e)},[]);const x=(0,e.useMemo)(()=>{const e=new URL(window.location.href);return["tag-id","tag","include-tags","exclude-tags","film-id","event-id","view","image","show-events","show-details","show-tags","year-round","search","q","page"].forEach(t=>e.searchParams.delete(t)),e.toString()},[]);(0,e.useEffect)(()=>{(async()=>{try{const e=window.EventiveBlockData?.eventBucket||"",t=window.EventiveBlockData?.apiEndpoints||{},n=window.EventiveBlockData?.eventNonce||"";if(!e)return p("Event bucket not configured."),void g(!1);const a=await wp.apiFetch({path:`/eventive/v1/${t.event_buckets}?bucket_id=${e}&endpoint=tags&eventive_nonce=${n}`,method:"GET"}),i=a?.tags||[];let o=null;"films"===r?o=s(await wp.apiFetch({path:`/eventive/v1/${t.event_buckets}?bucket_id=${e}&endpoint=films&eventive_nonce=${n}`,method:"GET"})):"events"===r&&(o=s(await wp.apiFetch({path:`/eventive/v1/${t.event_buckets}?bucket_id=${e}&endpoint=events&eventive_nonce=${n}`,method:"GET"}))),m(o),d(i),g(!1)}catch(e){console.error("Error loading tags:",e),p(e.message),g(!1)}})()},[r]);const b=e=>{const t=new URL(window.location.href);e?t.searchParams.set("tag-id",e):t.searchParams.delete("tag-id"),window.location.href=t.toString()};if(u)return(0,t.jsx)("div",{className:"eventive-tags-loading",style:{padding:"20px",textAlign:"center"},children:(0,t.jsx)("p",{children:"Loading tags..."})});if(v)return(0,t.jsx)("div",{className:"eventive-tags-error",style:{padding:"15px",backgroundColor:"#fef7f1",borderLeft:"4px solid #d63638",color:"#d63638"},children:(0,t.jsx)("p",{children:v})});const y=function(e){const t={},s={},a={};if(!e||"string"!=typeof e)return{ids:t,names:s,slugs:a};const i=e.split(",").map(e=>e.trim()).filter(e=>e);for(const e of i)t[e]=!0,s[e.toLowerCase()]=!0,a[n(e)]=!0;return{ids:t,names:s,slugs:a}}(c),j=l.filter(e=>{const t=String(e.id),s=e.name||"",a=n(s);return!(y.ids[t]||y.names[s.toLowerCase()]||y.slugs[a]||null!==w&&!w[t])});return 0===j.length?(0,t.jsx)("div",{className:"eventive-tags-empty",style:{padding:"20px",textAlign:"center"},children:(0,t.jsx)("p",{children:"No tags found."})}):"dropdown"===i?(0,t.jsxs)("div",{className:"eventive-tags-dropdown",children:[(0,t.jsx)("span",{children:"Filter by tag"}),(0,t.jsx)("br",{}),(0,t.jsxs)("select",{className:"eventive-tag-select",onChange:e=>{const t=e.target.value;b(t)},value:h,children:[(0,t.jsx)("option",{value:"",children:"All"}),j.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}):(0,t.jsxs)("div",{className:"eventive-tags-pills",children:[(0,t.jsx)(a,{tag:{id:"",name:"All",color:"#e0e0e0"},isActive:!h,onClick:b,resetUrl:x}),j.map(e=>(0,t.jsx)(a,{tag:e,isActive:h===String(e.id),onClick:b,resetUrl:x},e.id))]})};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-eventive-tags").forEach(n=>{if(n.querySelector(".eventive-tags-pills, .eventive-tags-dropdown"))return;const s=n.getAttribute("data-view")||"list",a=n.getAttribute("data-display")||"both",r="true"===n.getAttribute("data-hide-empty"),o=n.getAttribute("data-exclude-tags")||"";(0,e.createRoot)(n).render((0,t.jsx)(i,{view:s,display:a,hideEmpty:r,excludeTags:o}))})})})();