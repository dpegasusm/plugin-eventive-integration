(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(e){let t=e.toLowerCase();return t=t.replace(/&/g," and "),t=t.replace(/[^a-z0-9]+/g," "),t=t.trim().replace(/\s+/g," "),t}function s(e){const t={},n=[e];for(;n.length>0;){const e=n.pop();Array.isArray(e)?e.forEach(e=>{"object"==typeof e&&null!==e&&n.push(e)}):"object"==typeof e&&null!==e&&(e.tags&&Array.isArray(e.tags)&&e.tags.forEach(e=>{e&&e.id&&(t[String(e.id)]=!0)}),Object.values(e).forEach(e=>{"object"==typeof e&&null!==e&&n.push(e)}))}return t}const i=({tag:e,isActive:n,onClick:s,resetUrl:i})=>{const a=function(e){const t=e.replace("#","");return 6===t.length?(299*parseInt(t.substr(0,2),16)+587*parseInt(t.substr(2,2),16)+114*parseInt(t.substr(4,2),16))/1e3>150?"#000000":"#ffffff":"#000000"}(e.color),r=n?"is-active":"";return(0,t.jsx)("span",{className:`tag-label ${r}`,style:{backgroundColor:e.color,color:a},children:(0,t.jsx)("a",{href:e.id?`${i}${i.includes("?")?"&":"?"}tag-id=${e.id}`:i,className:"external-tag-filter","data-tag-id":e.id||"",style:{color:a},onClick:t=>{t.preventDefault(),s(e.id)},children:e.name})})},a=({view:a,display:r,hideEmpty:o,excludeTags:l})=>{const[c,d]=(0,e.useState)([]),[u,v]=(0,e.useState)(!0),[g,h]=(0,e.useState)(null),[p,f]=(0,e.useState)(""),[w,m]=(0,e.useState)(null);(0,e.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("tag-id")||"";f(e)},[]);const x=(0,e.useMemo)(()=>{const e=new URL(window.location.href);return["tag-id","tag","include-tags","exclude-tags","film-id","event-id","view","image","show-events","show-details","show-tags","year-round","search","q","page"].forEach(t=>e.searchParams.delete(t)),e.toString()},[]);(0,e.useEffect)(()=>{const e=()=>{const e=window.EventiveBlockData?.eventBucket||"";if(!e)return h("Event bucket not configured."),void v(!1);window.Eventive.request({method:"GET",path:`event_buckets/${e}/tags`,authenticatePerson:!1}).then(t=>{const n=t?.tags||[];return"films"===r?window.Eventive.request({method:"GET",path:`event_buckets/${e}/films`,authenticatePerson:!1}).then(e=>{const t=s(e);m(t),d(n),v(!1)}):"events"===r?window.Eventive.request({method:"GET",path:`event_buckets/${e}/events`,authenticatePerson:!1}).then(e=>{const t=s(e);m(t),d(n),v(!1)}):(m(null),d(n),void v(!1))}).catch(e=>{console.error("[eventive-tags] Error loading tags:",e),h(e.message),v(!1)})};window.Eventive&&window.Eventive._ready?e():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",e):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?e():(console.error("[eventive-tags] Eventive API not available"),h("Eventive API not available"),v(!1))},1e3)},[r]);const y=e=>{const t=new URL(window.location.href);e?t.searchParams.set("tag-id",e):t.searchParams.delete("tag-id"),window.location.href=t.toString()};if(u)return(0,t.jsx)("div",{className:"eventive-tags-loading",style:{padding:"20px",textAlign:"center"},children:(0,t.jsx)("p",{children:"Loading tags..."})});if(g)return(0,t.jsx)("div",{className:"eventive-tags-error",style:{padding:"15px",backgroundColor:"#fef7f1",borderLeft:"4px solid #d63638",color:"#d63638"},children:(0,t.jsx)("p",{children:g})});const E=function(e){const t={},s={},i={};if(!e||"string"!=typeof e)return{ids:t,names:s,slugs:i};const a=e.split(",").map(e=>e.trim()).filter(e=>e);for(const e of a)t[e]=!0,s[e.toLowerCase()]=!0,i[n(e)]=!0;return{ids:t,names:s,slugs:i}}(l),b=c.filter(e=>{const t=String(e.id),s=e.name||"",i=n(s);return!(E.ids[t]||E.names[s.toLowerCase()]||E.slugs[i]||null!==w&&!w[t])});return 0===b.length?(0,t.jsx)("div",{className:"eventive-tags-empty",style:{padding:"20px",textAlign:"center"},children:(0,t.jsx)("p",{children:"No tags found."})}):"dropdown"===a?(0,t.jsxs)("div",{className:"eventive-tags-dropdown",children:[(0,t.jsx)("span",{children:"Filter by tag"}),(0,t.jsx)("br",{}),(0,t.jsxs)("select",{className:"eventive-tag-select",onChange:e=>{const t=e.target.value;y(t)},value:p,children:[(0,t.jsx)("option",{value:"",children:"All"}),b.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}):(0,t.jsxs)("div",{className:"eventive-tags-pills",children:[(0,t.jsx)(i,{tag:{id:"",name:"All",color:"#e0e0e0"},isActive:!p,onClick:y,resetUrl:x}),b.map(e=>(0,t.jsx)(i,{tag:e,isActive:p===String(e.id),onClick:y,resetUrl:x},e.id))]})};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-eventive-tags").forEach(n=>{if(n.querySelector(".eventive-tags-pills, .eventive-tags-dropdown"))return;const s=n.getAttribute("data-view")||"list",i=n.getAttribute("data-display")||"both",r="true"===n.getAttribute("data-hide-empty"),o=n.getAttribute("data-exclude-tags")||"";(0,e.createRoot)(n).render((0,t.jsx)(a,{view:s,display:i,hideEmpty:r,excludeTags:o}))})})})();