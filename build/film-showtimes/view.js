document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-film-showtimes").forEach(t=>{const e=window.EventiveBlockData?.filmId,i=window.EventiveBlockData?.eventBucket||"";if(!e)return void(t.innerHTML='<div class="eventive-error">This block requires it be placed on a Eventive Film post type.</div>');if(!i)return void(t.innerHTML='<div class="eventive-error">Missing bucket configuration.</div>');t.innerHTML='<div class="eventive-loading">Loading showtimes...</div>';let n=!1;const v=()=>{n||(n=!0,window.Eventive&&window.Eventive.off&&window.Eventive.off("ready",v),window.Eventive.request({method:"GET",path:`event_buckets/${i}/films/${e}/events`,authenticatePerson:!1}).then(e=>{const i=e.events||[];if(0===i.length)return void(t.innerHTML='<div class="eventive-error">No upcoming showtimes available</div>');const n=function(t){const e={};return t.forEach(t=>{const i=new Date(t.start_time).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});e[i]||(e[i]=[]),e[i].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((t,e)=>new Date(t.start_time)-new Date(e.start_time))}),e}(i),v=Object.entries(n).map(([t,e])=>`\n\t\t\t\t\t\t\t\t<div class="eventive-showtime-date-group">\n\t\t\t\t\t\t\t\t\t<h3 class="eventive-showtime-date">${t}</h3>\n\t\t\t\t\t\t\t\t\t<div class="eventive-showtime-list">\n\t\t\t\t\t\t\t\t\t\t${e.map(t=>`\n\t\t\t\t\t\t\t\t\t\t\t<div class="eventive-showtime-item">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class="eventive-showtime-time">${new Date(t.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="eventive-button" data-event="${t.id}"></div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`).join("");t.innerHTML=`<div class="eventive-film-showtimes-container">${v}</div>`,window.Eventive?.rebuild&&window.Eventive.rebuild()}).catch(e=>{console.error("[eventive-film-showtimes] Error fetching showtimes:",e),t.innerHTML='<div class="eventive-error">Unable to load showtimes</div>'}))};window.Eventive&&window.Eventive._ready?v():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",v):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?v():t.innerHTML='<div class="eventive-error">Eventive API not available</div>'},1e3)})});