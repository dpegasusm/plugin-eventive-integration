(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function i({filmId:i,bucketId:s}){const[o,a]=(0,e.useState)([]),[r,v]=(0,e.useState)(!0),[c,l]=(0,e.useState)(null);return(0,e.useEffect)(()=>i&&s?window.Eventive&&window.Eventive.request?void window.Eventive.request({method:"GET",path:`event_buckets/${s}/films/${i}/events`,authenticatePerson:!1}).then(e=>{const t=e.events||[];if(0===t.length)l("No upcoming showtimes available");else{const e=function(e){const t={};return e.forEach(e=>{const i=new Date(e.start_time).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});t[i]||(t[i]=[]),t[i].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>new Date(e.start_time)-new Date(t.start_time))}),t}(t);a(e)}v(!1)}).catch(e=>{console.error("[eventive-film-showtimes] Error fetching showtimes:",e),l("Unable to load showtimes"),v(!1)}):(l("Eventive API not available"),void v(!1)):(l("Missing film or bucket ID"),void v(!1)),[i,s]),(0,e.useEffect)(()=>{!r&&!c&&o.length>0&&window.Eventive?.rebuild&&window.Eventive.rebuild()},[r,c,o]),r?(0,t.jsx)("div",{className:"eventive-loading",children:"Loading showtimes..."}):c?(0,t.jsx)("div",{className:"eventive-error",children:c}):(0,t.jsx)("div",{className:"eventive-film-showtimes-container",children:Object.entries(o).map(([e,i])=>(0,t.jsxs)("div",{className:"eventive-showtime-date-group",children:[(0,t.jsx)("h3",{className:"eventive-showtime-date",children:e}),(0,t.jsx)("div",{className:"eventive-showtime-list",children:i.map(e=>(0,t.jsx)(n,{event:e},e.id))})]},e))})}function n({event:e}){const i=new Date(e.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),n=e.venue?.name||"Venue TBA";return(0,t.jsxs)("div",{className:"eventive-showtime-item",children:[(0,t.jsxs)("div",{className:"eventive-showtime-info",children:[(0,t.jsx)("span",{className:"eventive-showtime-time",children:i}),(0,t.jsx)("span",{className:"eventive-showtime-venue",children:n})]}),(0,t.jsx)("div",{className:"eventive-showtime-button",children:(0,t.jsx)("div",{className:"eventive-button","data-event":e.id})})]})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-film-showtimes").forEach(n=>{const s=document.body.classList.contains("single-eventive_film")?document.querySelector('article[id^="post-"]')?.id?.replace("post-",""):null;s?(n.innerHTML='<div class="eventive-loading">Loading showtimes...</div>',fetch(`/wp-json/wp/v2/eventive_film/${s}`).then(e=>{if(!e.ok)throw new Error("Failed to fetch post data");return e.json()}).then(s=>{const o=s.meta?._eventive_film_id,a=s.meta?._eventive_bucket_id||window.EventiveBlockData?.eventBucket||"";o&&a?(0,e.createRoot)(n).render((0,t.jsx)(i,{filmId:o,bucketId:a})):n.innerHTML='<div class="eventive-error">Missing film or bucket configuration.</div>'}).catch(e=>{console.error("[eventive-film-showtimes] Error fetching post data:",e),n.innerHTML='<div class="eventive-error">Unable to load film data. Please try again later.</div>'})):n.innerHTML='<div class="eventive-error">Unable to determine the current post ID.</div>'})})})();