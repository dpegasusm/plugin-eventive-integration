(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime;function n(){const[n,t]=(0,e.useState)(!1),[a,i]=(0,e.useState)(!0),[c,l]=(0,e.useState)([]),[o,r]=(0,e.useState)(!1),[d,v]=(0,e.useState)(!1),[m,u]=(0,e.useState)(null),[h,p]=(0,e.useState)(null);(0,e.useEffect)(()=>{const e=async()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();t(e),e&&await x()}catch(e){console.error("Error checking login:",e)}finally{i(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on&&window.Eventive.on("ready",e),e()},[]);const x=async()=>{try{const e=window.EventiveBlockData?.apiEndpoints||{},s=window.EventiveBlockData?.eventNonce||"",n=await wp.apiFetch({path:`/eventive/v1/${e.passes}?self=true&eventive_nonce=${s}`,method:"GET"}),t=n&&(n.passes||n)||[];l(t)}catch(e){console.error("Error fetching passes:",e)}},j=()=>{r(!1),v(!1),u(null),p(null)};return a?(0,s.jsx)("div",{className:"eventive-login-container",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"},children:(0,s.jsx)("div",{className:"loader"})}):n?(0,s.jsxs)("div",{className:"eventive-account-passes",children:[(0,s.jsxs)("div",{className:"eventive-passes-list",children:[(0,s.jsx)("h2",{children:"My Passes"}),0===c.length?(0,s.jsx)("p",{children:"No passes found."}):(0,s.jsx)("div",{className:"eventive-passes-grid",children:c.map((e,n)=>{const t=e.name||e.pass_name||e.title||"Pass",a=[e.type||e.pass&&e.pass.type,null!=e.events_remaining?`${e.events_remaining} left`:"",null!=e.gross_cents?(e=>{try{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(e/100)}catch(s){return"$"+(e/100||0)}})(e.gross_cents):""].filter(Boolean).join(" • ");return(0,s.jsxs)("div",{className:"eventive-pass-card",children:[(0,s.jsxs)("div",{className:"eventive-pass-card__body",children:[(0,s.jsx)("div",{className:"eventive-pass-card__title",children:t}),a&&(0,s.jsx)("div",{className:"eventive-pass-card__meta",children:a})]}),(0,s.jsxs)("div",{className:"eventive-pass-card__actions",children:[(0,s.jsx)("button",{className:"eventive-pass-btn eventive-pass-btn--primary",onClick:()=>(e=>{p(e),v(!0)})(e),children:"Show Pass"}),(0,s.jsx)("button",{className:"eventive-pass-btn eventive-pass-btn--secondary",onClick:()=>(e=>{u(e),r(!0)})(e),children:"Edit Details"})]})]},n)})})]}),d&&h&&(0,s.jsx)("div",{className:"eventive-show-pass-barcode-modal",onClick:e=>e.target.classList.contains("eventive-show-pass-barcode-modal")&&j(),children:(0,s.jsxs)("div",{className:"show-pass-barcode-modal-content",children:[(0,s.jsx)("button",{className:"modal-close-btn",onClick:j,children:"×"}),(0,s.jsx)("h3",{children:"My Pass Credentials"}),(0,s.jsx)("div",{className:"barcode-meta",children:h.name||"Pass"}),h.barcode_url&&(0,s.jsx)("img",{src:h.barcode_url,alt:"Pass QR Code",className:"barcode-img"})]})}),o&&m&&(0,s.jsx)("div",{className:"eventive-edit-pass-modal",onClick:e=>e.target.classList.contains("eventive-edit-pass-modal")&&j(),children:(0,s.jsxs)("div",{className:"edit-pass-modal-content",children:[(0,s.jsx)("button",{className:"modal-close-btn",onClick:j,children:"×"}),(0,s.jsx)("h3",{children:"Edit Pass Details"}),(0,s.jsxs)("form",{children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Pass Name"}),(0,s.jsx)("input",{type:"text",defaultValue:m.name})]}),(0,s.jsx)("button",{type:"button",className:"pass-submit-row-button",children:"Save Changes"})]})]})})]}):(0,s.jsx)("div",{className:"eventive-notice",style:{textAlign:"center"},children:"Please log in to view your passes."})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-passes").forEach(t=>{(0,e.createRoot)(t).render((0,s.jsx)(n,{}))})})})();