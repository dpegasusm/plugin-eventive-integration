(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime;function n(...e){for(let s=0;s<e.length;s++){const n=e[s];if(null!=n&&""!==n)return n}return""}function t({bucket:t}){const[a,i]=(0,e.useState)(!1),[r,l]=(0,e.useState)(!0),[o,c]=(0,e.useState)([]),[d,v]=(0,e.useState)(!1),[u,m]=(0,e.useState)(!1),[p,h]=(0,e.useState)(null),[y,b]=(0,e.useState)(-1),[w,f]=(0,e.useState)(null),[j,g]=(0,e.useState)({}),x=(0,e.useRef)(!1);(0,e.useEffect)(()=>{let e=!1,s=0;const n=()=>{if(!e){if(!window.Eventive||!window.Eventive.isLoggedIn)return s++,void(s<60?setTimeout(n,100):l(!1));try{const s=window.Eventive.isLoggedIn();i(s),s&&!x.current&&(x.current=!0,N(e))}catch(e){}finally{l(!1)}}};return window.Eventive&&window.Eventive.on&&window.Eventive.on("ready",n),n(),()=>{e=!0,window.Eventive&&window.Eventive.off&&window.Eventive.off("ready",n)}},[]);const N=e=>{if(!window.Eventive||!window.Eventive.isLoggedIn||!window.Eventive.isLoggedIn())return i(!1),l(!1),void(x.current=!1);const s={};if(t)try{s.conditions=JSON.stringify({event_bucket:t})}catch(e){}window.Eventive.request({method:"GET",path:"people/self/passes",qs:s,authenticatePerson:!0}).then(s=>{if(e)return;const n=s&&(s.passes||s)||[];c(n)}).catch(n=>{if(e)return;const t=(n&&(n.message||n.error||""))+"";if(t.includes("InvalidCredentials")||t.includes("401")||t.includes("Unauthorized")||t.includes("not logged in"))return i(!1),l(!1),void(x.current=!1);window.Eventive.request({method:"GET",path:"people/self/passes_including_global",qs:s,authenticatePerson:!0}).then(s=>{if(e)return;const n=s&&(s.passes||s)||[];c(n)}).catch(s=>{if(e)return;const n=(s&&(s.message||s.error||""))+"";(n.includes("InvalidCredentials")||n.includes("401")||n.includes("Unauthorized")||n.includes("not logged in"))&&(i(!1),x.current=!1)})})},E=()=>{v(!1),m(!1),h(null),b(-1),f(null),g({})};return(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&E()};return(d||u)&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[d,u]),r?(0,s.jsx)("div",{className:"eventive-login-container",children:(0,s.jsx)("div",{className:"loader"})}):a?(0,s.jsxs)("div",{className:"eventive-account-passes",children:[(0,s.jsxs)("div",{className:"eventive-passes-list",children:[(0,s.jsx)("h2",{children:"My Passes"}),0===o.length?(0,s.jsx)("p",{children:"No passes found for this account."}):(0,s.jsx)("div",{className:"eventive-passes-grid",children:o.map((e,t)=>{const a=n(e.name,e.pass_name,e.title,"Pass"),i=n(e.type,e.pass&&e.pass.type),r=null!=e.events_remaining?`${e.events_remaining} left`:"",l=null!=e.gross_cents?function(e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(e/100)}catch(s){return"$"+(e/100||0)}}(e.gross_cents):"",o=e.benefits&&Array.isArray(e.benefits)?e.benefits.join(", "):"",c=[i,r,l].filter(Boolean).join(" • ");return(0,s.jsxs)("div",{className:"eventive-pass-card",children:[(0,s.jsxs)("div",{className:"eventive-pass-card__body",children:[(0,s.jsx)("div",{className:"eventive-pass-card__title",children:a}),c&&(0,s.jsx)("div",{className:"eventive-pass-card__meta",children:c}),o&&(0,s.jsx)("div",{className:"eventive-pass-card__benefits",children:o})]}),(0,s.jsxs)("div",{className:"eventive-pass-card__actions",children:[(0,s.jsx)("button",{className:"evt-btn evt-btn-secondary",onClick:()=>((e,s)=>{h(e),b(s),g({name:n(e.name,e.pass_name,""),supplementary:e.supplementary_data||{}}),v(!0)})(e,t),children:"Edit"}),(0,s.jsx)("button",{className:"evt-btn evt-btn-primary",onClick:()=>(e=>{f(e),m(!0)})(e),children:"Show Barcode"})]})]},t)})})]}),u&&w&&(0,s.jsx)("div",{className:"eventive-modal-overlay eventive-modal-overlay--dark",onClick:e=>e.target.classList.contains("eventive-modal-overlay")&&E(),children:(0,s.jsxs)("div",{className:"eventive-modal-panel eventive-modal-panel--small show-pass-barcode-modal-content",children:[(0,s.jsx)("button",{className:"eventive-modal-close-btn",onClick:E,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{className:"barcode-modal-title",children:"My Pass Credentials"}),(0,s.jsx)("div",{className:"barcode-meta",children:n(w.name,w.pass_name,"Pass")}),(()=>{const e=(t=n(w.qr_code_path,w.barcode_path,w.barcode&&w.barcode.path))?/^https?:\/\//i.test(t)?t:"https://api.eventive.org"+("/"===t.charAt(0)?"":"/")+t:t;var t;return e?(0,s.jsx)("img",{className:"barcode-img",src:e,alt:`${w.name||"Pass"} QR Code`}):(0,s.jsx)("p",{children:"No barcode available"})})(),(0,s.jsx)("div",{className:"barcode-tip",children:"Present this code at entry. Tip: increase screen brightness for easier scanning."})]})}),d&&p&&(0,s.jsx)("div",{className:"eventive-modal-overlay",onClick:e=>e.target.classList.contains("eventive-modal-overlay")&&E(),children:(0,s.jsxs)("div",{className:"eventive-modal-panel edit-pass-modal-content",children:[(0,s.jsx)("button",{className:"eventive-modal-close-btn",onClick:E,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{children:"Edit Pass Details"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const s={};j.name&&""!==j.name.trim()&&(s.name=j.name.trim()),j.supplementary&&Object.keys(j.supplementary).length&&(s.supplementary_data=j.supplementary);const n=p.id||p.pass&&p.pass.id;n?window.Eventive.request({method:"POST",path:"passes/"+encodeURIComponent(n),body:s,authenticatePerson:!0}).then(()=>{E(),N()}).catch(e=>{console.error("Failed to update pass:",e),alert("Failed to update pass.")}):console.warn("[passes] missing pass id")},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Pass Name"}),(0,s.jsx)("input",{type:"text",value:j.name||"",onChange:e=>g({...j,name:e.target.value}),required:!0})]}),p.supplementary_data&&(()=>{const e=p.supplementary_data;return Array.isArray(e)?e.map((e,n)=>{const t=e.key||e.name||e.id,a=e.label||e.name||t,i=null!=j.supplementary?.[t]?j.supplementary[t]:null!=e.value?e.value:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:a||t}),(0,s.jsx)("input",{type:"text",value:i,onChange:e=>g({...j,supplementary:{...j.supplementary,[t]:e.target.value}})})]},n)}):"object"==typeof e&&null!==e?Object.keys(e).map(n=>{const t=null!=j.supplementary?.[n]?j.supplementary[n]:null!=e[n]?e[n]:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:n}),(0,s.jsx)("input",{type:"text",value:t,onChange:e=>g({...j,supplementary:{...j.supplementary,[n]:e.target.value}})})]},n)}):null})(),(0,s.jsx)("div",{className:"form-submit-row",children:(0,s.jsx)("button",{type:"submit",className:"pass-submit-row-button",children:"Save Changes"})})]})]})})]}):(0,s.jsx)("div",{className:"eventive-notice",children:"Please log in to view your passes."})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-passes").forEach(n=>{const a=window.EventiveBlockData?.eventBucket||"";(0,e.createRoot)(n).render((0,s.jsx)(t,{bucket:a}))})})})();