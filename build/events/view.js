(()=>{window.__Eventive_EventCache=window.__Eventive_EventCache||{};let e="";function t(e){return null==e||!("false"===(e=String(e).trim().toLowerCase())||"0"===e||"no"===e||"off"===e||""===e)}function i(e,t){try{const i=new URL(window.location.href);e?i.searchParams.set("tag-id",e):i.searchParams.delete("tag-id"),"replace"===t?history.replaceState({},"",i.toString()):history.pushState({},"",i.toString())}catch(e){}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-events").forEach(n=>{if(n.__inited)return;n.__inited=!0;const a=window.EventiveBlockData?.eventBucket||window.EventiveBlockData?.eventBucket||"",r=n.getAttribute("data-tag-id")||"",s=n.getAttribute("data-venue-id")||"",o=n.getAttribute("data-image")||"poster",l=t(n.getAttribute("data-description")),c=t(n.getAttribute("data-show-filter")),v=(n.getAttribute("data-event-id"),n.getAttribute("data-films-base")||"");v&&!e&&(e=v);const d=v||window.EventiveBlockData?.filmDetailBaseURL||"";window.EventiveBlockData,window.EventiveBlockData;let u=r,m=[];const g=()=>{if(!c)return;const e=n.querySelector(".eventive-events-tags-filter");if(e)try{const t=e.querySelectorAll(".eventive-tag-btn");t.forEach(e=>{e.classList.remove("active")}),t.forEach(e=>{const t=e.getAttribute("data-tag-id")||"";u?t===u&&e.classList.add("active"):t||e.classList.add("active")})}catch(e){}},f=t=>{const a=t||m,r=(e=>{const t=[];return(e||[]).forEach(e=>{if(!s||e.venue&&e.venue.id===s){if(u){const t=Array.isArray(e.tags)?e.tags:[],i=e.films&&e.films[0]&&Array.isArray(e.films[0].tags)?e.films[0].tags:[],n=t.concat(i),a=[],r=[];if(n.forEach(e=>{e&&(null!=e.id&&a.push(String(e.id)),e.name&&r.push(e.name.toLowerCase()))}),!a.includes(u)&&!r.includes(u.toLowerCase()))return}t.push(e)}}),t})(a);if(c){const e=(e=>{const t=new Map;return e.forEach(e=>{const i=Array.isArray(e.tags)?e.tags:[],n=(Array.isArray(e.films)?e.films:[]).flatMap(e=>Array.isArray(e.tags)?e.tags:[]);i.concat(n).forEach(e=>{if(!e)return;const i=null!=e.id?String(e.id):"",n=e.name||e.title||e.label||(i?"#"+i:"");if(!i&&!n)return;const a=i||n.toLowerCase();t.has(a)||t.set(a,{id:i,name:n,color:e.color||"#e0e0e0",count:0}),t.get(a).count++})}),Array.from(t.values()).sort((e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1)})(a);(e=>{if(!c||!e.length)return;let t=n.querySelector(".eventive-events-tags-filter");t||(t=document.createElement("div"),t.className="eventive-events-tags-filter",n.insertBefore(t,n.firstChild));const a='<button class="eventive-tag-btn '+(u?"":"active")+'" data-tag-id="">All</button>',r=e.map(e=>{const t=e.color||"#e0e0e0",i=function(e){let t=(e||"").replace("#","");return 3===t.length&&(t=t.split("").map(e=>e+e).join("")),(299*(parseInt(t.substr(0,2),16)||0)+587*(parseInt(t.substr(2,2),16)||0)+114*(parseInt(t.substr(4,2),16)||0))/1e3>150?"#000":"#fff"}(t);return'<button class="eventive-tag-btn '+(u===e.id||u===e.name?"active":"")+'" data-tag-id="'+(e.id||e.name)+'" style="background-color:'+t+";color:"+i+';">'+e.name+"</button>"}).join("");t.innerHTML='<div class="eventive-tags-list">'+a+r+"</div>",t.__evtClickBound||(t.__evtClickBound=!0,t.addEventListener("click",e=>{const t=e.target.closest(".eventive-tag-btn");t&&(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),e.stopPropagation(),u=t.getAttribute("data-tag-id")||"",i(u,"replace"),g(),f(m)))},!0))})(e)}const v=n.querySelector(".eventive-film-loading-text");if(v&&v.remove(),!r.length){const e=document.createElement("div");return e.className="event-schedule-container",e.innerHTML='<p class="no-events">No upcoming events found.</p>',void n.appendChild(e)}const p={};r.forEach(e=>{if(!e.start_time)return;const t=new Date(e.start_time);if(isNaN(t))return;const i=t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});p[i]||(p[i]=[]),p[i].push(e)});let _='<div class="event-schedule-container">';Object.keys(p).forEach(t=>{const i=p[t],n="events-count-"+Math.min(i.length,3);_+='<div class="event-group">',_+='<h3 class="event-group-header">'+t+"</h3>",_+='<div class="event-group-items '+n+'">',i.forEach(t=>{const i=new Date(t.start_time).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"}),n=t.name||"Untitled Event",a=t.description||"",r=t.venue&&t.venue.name||"";let s="";"none"!==o&&(s=function(e,t){if(!e)return"";const i=[e.image,e.poster_image,e.cover_image,e.still_image,e.film_poster_image,e.film_cover_image,e.film_still_image];e.program_item&&i.push(e.program_item.image,e.program_item.poster_image,e.program_item.cover_image,e.program_item.still_image),i.push(e.tile_image,e.hero_image,e.card_image);const n=e.film||e.films&&e.films[0]||e.program_item?.film;n&&("poster"===t?i.push(n.poster_image,n.poster_url,n.cover_image,n.still_image):"cover"===t?i.push(n.cover_image,n.cover_url,n.still_image,n.poster_image):"still"===t?i.push(n.still_image,n.still_url,n.poster_image,n.cover_image):i.push(n.poster_image,n.poster_url,n.cover_image,n.still_image));for(let e=0;e<i.length;e++){const t=i[e];if("string"==typeof t&&t)return t}return""}(t,o));let c="";s&&(c='<img class="eventive-card-image" src="'+s+'" alt="'+n+'" loading="lazy" decoding="async" />');let v="";l&&a&&(v='<p class="eventive-card-description">'+a+"</p>");let u="";r&&(u='<p class="eventive-card-meta">'+r+"</p>");let m="";const g=t.film||t.films&&t.films[0]||null;if(g&&d){const t=function(t){if(!t||"object"!=typeof t)return"";const i=["wp_detail_url","wp_permalink","permalink","detail_url","details_url","url","public_url","site_url"];for(let e=0;e<i.length;e++){const n=t[i[e]];if("string"==typeof n&&n)return n}const n=t.id||t.slug||t.slugified_title;return n&&e?e.replace(/\/+$/,"")+"/?film-id="+encodeURIComponent(n):""}(g);t&&(m='<p class="eventive-card-link"><a href="'+t+'">'+(g.name||g.title||"Film Details")+"</a></p>")}_+='<div class="eventive-card">',c&&(_+=c),_+='<div class="eventive-card-content">',_+='<h4 class="eventive-card-title">'+n+"</h4>",_+='<p class="eventive-card-meta">'+i+"</p>",u&&(_+=u),m&&(_+=m),v&&(_+=v),_+='<div class="eventive-button" data-event="'+(t.id||"")+'"></div>',_+="</div></div>"}),_+="</div></div>"}),_+="</div>",n.innerHTML=_,setTimeout(()=>{n.querySelector(".eventive-button")&&window.Eventive?.rebuild&&window.Eventive.rebuild()},100)};document.addEventListener("eventive:setActiveTag",e=>{const t=e&&e.detail&&void 0!==e.detail.tagId?e.detail.tagId:e.detail||"";u=String(t||""),i(u,"replace"),g(),f(m)}),window.addEventListener("popstate",()=>{try{u=new URL(window.location.href).searchParams.get("tag-id")||r,g(),f(m)}catch(e){}}),(()=>{if(!window.Eventive)return void(n.innerHTML='<p class="error-message">Eventive API is not initialized. Please check your integration.</p>');const e=()=>{(function(e,t){const i=!!(t=t||{}).includePast,n=!!t.includeVirtual,a=e+"::past="+(i?1:0)+"::virt="+(n?1:0),r=window.__Eventive_EventCache;if(r[a])return Promise.resolve(r[a]);if(!window.Eventive)return Promise.reject(new Error("Eventive API is not initialized."));const s={};return i||(s.upcoming_only=!0),n&&(s.include_virtual=!0),window.Eventive.request({method:"GET",path:"event_buckets/"+encodeURIComponent(e)+"/events",qs:s,authenticatePerson:!0}).then(e=>{const t=e&&e.events||[];return r[a]=t,r[a]})})(a,{includePast:!1,includeVirtual:!0}).then(e=>{m=e,f(e)}).catch(e=>{console.error("[eventive-events] Error fetching events:",e),n.innerHTML='<p class="error-message">Failed to load events.</p>'})};window.Eventive._ready||window.Eventive.ready?e():window.Eventive.on("ready",e)})()})})})();