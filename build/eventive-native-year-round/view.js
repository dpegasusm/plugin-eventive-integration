(()=>{"use strict";function e(e){return(e<10?"0":"")+e}function t(t){return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())}function n(e){const t=new Date(e),n=t.getDay(),i=(0===n?-6:1)-n;return t.setDate(t.getDate()+i),t.setHours(0,0,0,0),t}function i(e){const t=n(e),i=new Date(t);return i.setDate(i.getDate()+6),i.setHours(23,59,59,999),i}function a(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n}function r(e){return e.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}function s(e){const t=new Date(e);return t.setHours(0,0,0,0),t}function o(e,t){return+e<+t}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-native-year-round").forEach(e=>{if(e.__inited)return;e.__inited=!0;const c=window.EventiveBlockData?.apiEndpoints||{},l=window.EventiveBlockData?.eventNonce||"",d=window.EventiveBlockData?.eventBucket||window.eventiveOptions?.eventBucket||"",v=e.getAttribute("data-image")||"poster",m="true"===e.getAttribute("data-description"),u="true"===e.getAttribute("data-venue"),p="true"===e.getAttribute("data-details"),y=window.eventiveOptions?.filmDetailBaseURL||"",_=window.eventiveOptions?.usePrettyPermalinks||!1,f=window.eventiveOptions?.filmSyncEnabled||!1,w=new Date,g=s(w),h=n(w);let b=n(w),D=i(w),E=new Date(Math.max(+b,+g));const $={};let L={},N=!1;const k=document.createElement("div");k.className="eventive-nyr-calendar-wrap";const S=document.createElement("div");S.className="eventive-nyr-nav",S.innerHTML='\n\t\t\t<button class="eventive-nyr-btn eventive-nyr-prev" type="button">‹ Prev</button>\n\t\t\t<div class="eventive-nyr-buttons"></div>\n\t\t\t<button class="eventive-nyr-btn eventive-nyr-next" type="button">Next ›</button>\n\t\t',k.appendChild(S);const C=document.createElement("div");C.className="eventive-nyr-events",k.appendChild(C),e.appendChild(k);const x=S.querySelector(".eventive-nyr-prev"),T=S.querySelector(".eventive-nyr-next"),M=S.querySelector(".eventive-nyr-buttons"),A=()=>{N||(N=!0,requestAnimationFrame(()=>{N=!1,O()}))},H=()=>{let e="";for(let n=0;n<7;n++){const i=a(b,n),c=t(i),l=c===t(E),d=o(s(i),g);e+=`<button class="yr-day-btn ${l?"is-active":""} ${d?"is-disabled":""}" data-day="${c}" type="button" ${d?"disabled":""}>${r(i)}</button>`}M.innerHTML=e,M.querySelectorAll(".yr-day-btn").forEach(e=>{e.addEventListener("click",()=>{if(e.hasAttribute("disabled"))return;const t=e.getAttribute("data-day");E=new Date(t+"T12:00:00"),H(),A()})})},O=()=>{const e=t(E),n=L&&L[e]||[];if(!n.length)return void(C.innerHTML='<div class="yr-no-events">No events this day.</div>');const i={};n.forEach(e=>{const t=e.venue&&e.venue.id||(e.is_virtual?"virtual":"unknown"),n=e.films&&e.films[0]||e.film||null,a=n&&n.id||"",r=e.name||e.title||n&&(n.name||n.title)||"Untitled",s=t+"::"+(a||r);i[s]||(i[s]={evRef:e,film:n||{},title:r,venueName:e.venue&&(e.venue.name||e.venue.display_name||e.venue.slug)||(e.is_virtual?"Virtual":"TBA"),items:[]}),i[s].items.push({id:e.id,dt:new Date(e.start_time),ev:e})});const a=Object.values(i);a.forEach(e=>{e.items.sort((e,t)=>+e.dt-+t.dt)}),a.sort((e,t)=>+e.items[0].dt-+t.items[0].dt),C.innerHTML="",a.forEach(e=>{const t=e.evRef,n=t.film||t.films&&t.films[0]||{},i=e.title;let a="";var r;"none"!==v&&(a=function(e,t){return e?"cover"===t?e.cover_image||e.still_image||e.poster_image||"":"still"===t?e.still_image||e.poster_image||e.cover_image||"":"none"===t?"":e.poster_image||e.cover_image||e.still_image||"":""}(n,v)||(r=t)&&(r.image||r.poster_image||r.cover_image||r.still_image||r.film_poster_image||r.film_cover_image)||""||"");const s=m&&(t.short_description||t.description||n.short_description||n.description)||"",o=p?(e=>{const t=e&&e.film;if(!t)return"#";if(f){const e=t.slug||String(t.name||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");return(y||"").replace(/\/$/,"")+"/"+e}return _?y+"?film-id="+encodeURIComponent(t.id||""):y+"&film-id="+encodeURIComponent(t.id||"")})(t):"#",c=document.createElement("article");if(c.className="yr-card yr-card--stack"+(a?" has-media":""),a){const e=document.createElement("div");e.className="yr-card__media",e.innerHTML=`<img loading="lazy" decoding="async" alt="${i}" src="${a}" />`,c.appendChild(e)}const l=document.createElement("div");l.className="yr-card__body",l.innerHTML=`\n\t\t\t\t\t<h3 class="yr-card__title">${i}</h3>\n\t\t\t\t\t${u?`<div class="yr-card__meta">${e.venueName}</div>`:""}\n\t\t\t\t\t${s?`<div class="yr-card__desc">${s}</div>`:""}\n\t\t\t\t\t${p?`<div class="yr-card__links"><a class="yr-more" href="${o}">Details</a></div>`:""}\n\t\t\t\t`,c.appendChild(l);const d=document.createElement("div");d.className="yr-card__cta";const w=document.createElement("div");w.className="yr-card__showtimes yr-showtimes-flex",w.style.display="flex",w.style.flexWrap="wrap",w.style.gap="8px 12px",w.style.alignItems="stretch",e.items.forEach(e=>{const t=document.createElement("div");var n;t.className="yr-showtime__btn",t.style.flex="0 1 240px",t.innerHTML=`<div class="eventive-button" data-event="${e.id}" data-label="${n=e.dt,n.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})}"></div>`,w.appendChild(t)}),d.appendChild(w),c.appendChild(d),C.appendChild(c)}),window.Eventive?.rebuild&&setTimeout(()=>{window.Eventive.rebuild()},60)},B=async()=>{const e=b,n=D,i=t(e);if($[i])L=$[i];else try{const a=new URLSearchParams;a.append("start_time_gte",new Date(e).toISOString()),a.append("start_time_lte",new Date(n).toISOString()),a.append("include_past_events","true"),a.append("include","film,films,program_item"),a.append("eventive_nonce",l);const r=await wp.apiFetch({path:`/eventive/v1/${c.event_buckets}/${d}/events?${a.toString()}`,method:"GET"});let o=r&&(r.events||r)||[];o=o.filter(t=>{if(!t||!t.start_time)return!1;const i=new Date(t.start_time);return!isNaN(i)&&i>=e&&i<=n});const v={};t(b)===t(h)&&(o=o.filter(e=>+s(new Date(e.start_time))>=+g)),o.sort((e,t)=>new Date(e.start_time)-new Date(t.start_time)),o.forEach(e=>{!e.film&&e.films&&e.films[0]&&(e.film=e.films[0]);const n=t(new Date(e.start_time));(v[n]||(v[n]=[])).push(e)}),L=v,$[i]=v}catch(e){console.error("Error fetching week events:",e),L={}}},q=()=>{const e=!o(h,b);x.disabled=e,e?x.classList.add("is-disabled"):x.classList.remove("is-disabled")},R=async e=>{let n=a(b,7*e);o(n,h)&&(n=h),b=n,D=i(b),E=new Date(Math.max(+b,+g)),H();const r=t(b);$[r]?(L=$[r],A()):(await B(),A()),q()};x.addEventListener("click",()=>R(-1)),T.addEventListener("click",()=>R(1)),(async()=>{H(),q(),await B(),A()})()})})})();