(()=>{"use strict";function e(e,t){try{return t.reduce((e,t)=>e&&void 0!==e[t]?e[t]:void 0,e)}catch(e){return}}function t(e){if(!Array.isArray(e))return"";for(let t=0;t<e.length;t++){const r=e[t];if(r){if("string"==typeof r&&r.trim())return r.trim();if("object"==typeof r&&"string"==typeof r.url&&r.url.trim())return r.url.trim()}}return""}function r(e,t){if(!t||!t.length)return!1;const r=function(e){const t=[];return Array.isArray(e.tags)&&e.tags.forEach(e=>{const r=e&&(e.name||e.title||e.label)?String(e.name||e.title||e.label).toLowerCase():"";r&&t.push(r)}),Array.isArray(e.tag_names)&&e.tag_names.forEach(e=>{const r=e?String(e).toLowerCase():"";r&&t.push(r)}),Array.isArray(e.categories)&&e.categories.forEach(e=>{const r=e?String(e).toLowerCase():"";r&&t.push(r)}),e.category&&t.push(String(e.category).toLowerCase()),Array.from(new Set(t))}(e);return t.some(e=>r.indexOf(e)>-1)}function n(e){return e?String(e).split(",").map(e=>e.trim().toLowerCase().replace(/\s+/g," ")).filter(Boolean):[]}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".eventive-marquee-wrapper").forEach(a=>{if(a.__inited)return;a.__inited=!0,window.EventiveBlockData,window.EventiveBlockData;const i=window.EventiveBlockData?.eventBucket||window.EventiveBlockData?.eventBucket||"",o=a.querySelector(".eventive-marquee-overlay"),s=a.getAttribute("data-overlay-url")||"",l=parseFloat(a.getAttribute("data-overlay-opacity")||"0.22");o&&(o.style.backgroundImage=s?`url(${s})`:"",o.style.opacity=isNaN(l)?"0.22":String(Math.max(0,Math.min(1,l))));const c=(a.getAttribute("data-caption")||"").trim(),u=a.querySelector(".eventive-marquee-caption-track");if(u)if(c){const e=" â€¢ "+c+" ";let t=c;for(;t.length<200;)t+=e;u.textContent=t}else u.textContent="";const d="true"===a.getAttribute("data-film-sync-enabled"),m="true"===a.getAttribute("data-pretty-permalinks"),g=a.getAttribute("data-detail-base-url")||"",p=a.querySelector(".eventive-marquee");if(!p)return;const f=p.getAttribute("data-tag")||"",v=Math.min(parseInt(p.getAttribute("data-number"),10)||5,50),h=(p.getAttribute("data-stills")||"").toString().toLowerCase(),y="true"===h||"1"===h||"yes"===h,w="true"===p.getAttribute("data-year-round"),E=p.getAttribute("data-exclude")||"";(()=>{const o=()=>{const o=new URLSearchParams;w&&o.append("marquee","true");let s=`event_buckets/${i}/films`;o.toString()&&(s+=`?${o.toString()}`),window.Eventive.request({method:"GET",path:s,authenticatePerson:!1}).then(i=>{const o=function(e,t,a){const i=n(t),o=n(a);return(e||[]).filter(e=>{const t=!i.length||r(e,i),n=!o.length||!r(e,o);return t&&n})}(i&&i.films||[],f,E),s=document.createElement("div");s.className="marquee-content",o.slice(0,v).forEach(r=>{const n=function(r,n){const a=[e(r,["images","still_image"]),e(r,["images","still"]),e(r,["images","stillImage"]),e(r,["images","still_url"]),e(r,["images","still","url"]),e(r,["images","still_image","url"]),e(r,["still_image"]),e(r,["still_url"])],i=[e(r,["poster_image"]),e(r,["images","poster_image"]),e(r,["images","poster"]),e(r,["images","poster","url"]),e(r,["poster","url"])];let o="";return n&&(o=t(a)),o||(o=t(i)),o||""}(r,y);s.appendChild(((e,t,r)=>{if(!t){const e=document.createElement("a");return e.href="#",e.className="poster-slide placeholder",e.setAttribute("aria-hidden","true"),e}const n=String(e||"").toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").trim();let a;a=d?g.replace(/\/$/,"")+"/"+n:m?g+"?film-id="+encodeURIComponent(r):g+"&film-id="+encodeURIComponent(r);const i=document.createElement("div");i.className="poster-slide",i.style.backgroundImage="url('"+t+"')";const o=document.createElement("a");return o.href=a,o.target="_self",o.appendChild(i),o.addEventListener("click",e=>{e.stopPropagation()}),o})(r.name,n,r.id))});let l=Array.from(s.children),c=210*l.length;const h=p.offsetWidth;for(;c<h;)l.forEach(e=>{s.appendChild(e.cloneNode(!0))}),l=Array.from(s.children),c=210*l.length;var w;w=s,Array.from(w.children).forEach(e=>{w.appendChild(e.cloneNode(!0))});const A=210*s.children.length;s.style.width=A+"px";const b=Math.max(20,Math.min(180,Math.round(A/60)));s.style.animationDuration=b+"s";const C=(a.getAttribute("data-caption-speed")||"match").toLowerCase();let S=b;const _=parseInt(C,10);!isNaN(_)&&_>0&&(S=_),u&&(u.textContent||"").trim().length&&(u.style.animationDuration=S+"s",u.classList.add("caption-scroll")),p.appendChild(s)}).catch(e=>{console.error("[eventive-marquee] Error fetching marquee films:",e)})};window.Eventive&&window.Eventive._ready?o():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",o):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?o():console.error("[eventive-marquee] Eventive API not available")},1e3)})()})})})();