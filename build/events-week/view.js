(()=>{"use strict";window.wp.element,document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".wp-block-eventive-events-week");async function t(e){const t=window.EventiveBlockData?.eventBucket||"";if(window.EventiveBlockData,!t)return void(e.innerHTML='<p class="error-message">Event bucket not configured.</p>');let i=function(e){const t=new Date(e);return t.setHours(0,0,0,0),t.setDate(t.getDate()-t.getDay()),t}(new Date);const r=await async function(e){return window.Eventive.request({method:"GET",path:`event_buckets/${e}/events`,authenticatePerson:!1}).then(e=>e.events||[]).catch(e=>(console.error("[eventive-events-week] Error fetching all events:",e),[]))}(t);n(e,r,i),o(e,i),function(e,t,i,r){const a=e.querySelector("#prev-week"),c=e.querySelector("#next-week");a&&a.addEventListener("click",()=>{const a=new Date(i);a.setDate(a.getDate()-7),r(a),n(e,t,a),o(e,a)}),c&&c.addEventListener("click",()=>{const a=new Date(i);a.setDate(a.getDate()+7),r(a),n(e,t,a),o(e,a)})}(e,r,i,e=>{i=e}),function(e){const t=e.querySelector(".event-modal"),n=e.querySelector(".close-modal");n&&n.addEventListener("click",()=>{t&&(t.style.display="none")}),window.addEventListener("click",e=>{e.target===t&&(t.style.display="none")})}(e)}function n(e,t,n){const o=e.querySelector(".weekly-calendar-grid");if(!o)return;const i=new Date(n);i.setDate(i.getDate()+6);const r=t.filter(e=>{const t=new Date(e.start_time);return t>=n&&t<=i});if(0===r.length)return void(o.innerHTML='<p class="no-events">No events scheduled for this week.</p>');const a={};for(let e=0;e<7;e++){const t=new Date(n);t.setDate(t.getDate()+e);const o=t.toDateString();a[o]=[]}r.forEach(e=>{const t=new Date(e.start_time).toDateString();a[t]&&a[t].push(e)});let c='<table class="week-table"><thead><tr>';for(let e=0;e<7;e++){const t=new Date(n);t.setDate(t.getDate()+e),c+=`<th>${t.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}</th>`}c+="</tr></thead><tbody><tr>";for(let e=0;e<7;e++){const t=new Date(n);t.setDate(t.getDate()+e);const o=t.toDateString(),i=a[o]||[];c+='<td><div class="day-events">',i.forEach(e=>{const t=new Date(e.start_time).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});c+=`<div class="event-item" data-event-id="${e.id}">\n\t\t\t\t\t<div class="event-time">${t}</div>\n\t\t\t\t\t<div class="event-name">${e.name}</div>\n\t\t\t\t</div>`}),c+="</div></td>"}c+="</tr></tbody></table>",o.innerHTML=c,o.querySelectorAll(".event-item").forEach(n=>{n.addEventListener("click",()=>{const o=n.getAttribute("data-event-id"),i=t.find(e=>e.id===o);i&&function(e,t){const n=e.querySelector(".event-modal"),o=e.querySelector("#modal-details");if(!n||!o)return;const i=new Date(t.start_time).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});o.innerHTML=`\n\t\t\t<h2>${t.name}</h2>\n\t\t\t<p><strong>Time:</strong> ${i}</p>\n\t\t\t${t.venue?`<p><strong>Venue:</strong> ${t.venue.name}</p>`:""}\n\t\t\t${t.description?`<p>${t.description}</p>`:""}\n\t\t\t<button class="eventive-button" data-eventive-event-id="${t.id}">Buy Tickets</button>\n\t\t`,n.style.display="block",window.Eventive.rebuild&&window.Eventive.rebuild()}(e,i)})})}function o(e,t){const n=e.querySelector("#current-week-range");if(!n)return;const o=new Date(t);o.setDate(o.getDate()+6),n.textContent=`${t.toLocaleDateString(void 0,{month:"short",day:"numeric"})} - ${o.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}`}0!==e.length&&(window.Eventive&&window.Eventive.on?window.Eventive.on("ready",async function(){e.forEach(t)}):console.error("Eventive API is not loaded or not ready."))})})();