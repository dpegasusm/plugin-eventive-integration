(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(...e){for(let t=0;t<e.length;t++){const n=e[t];if(null!=n&&""!==n)return n}}function s(e,t){if(!e||!e.length)return;if(!t)return e[0];const n=e[0];return n&&"object"==typeof n?n[t]:n}function a(e){if(!e||"object"!=typeof e)return e;const t=[e.street||e.line1||e.address1,e.line2||e.address2,e.city,e.region||e.state,e.postal_code||e.postalCode||e.zip,e.country].filter(Boolean);return t.length?t.join(", "):void 0}function i(){const[i,l]=(0,e.useState)(!1),[o,r]=(0,e.useState)(!0),[c,d]=(0,e.useState)(null),[u,m]=(0,e.useState)(null),[v,h]=(0,e.useState)("");(0,e.useEffect)(()=>{const e=async()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();if(l(e),e){const e=await window.Eventive.request({method:"GET",path:"people?self=true",authenticatePerson:!0}),t=e&&(e.person||e);window.eventivePersonId=t&&t.id;const i=function(e){if(!e||"object"!=typeof e)return{};const t=e.details||{},i=e.addresses||t.addresses,l=e.phones||t.phones,o=e.emails||t.emails;return{name:n(e.name,t.name,e.full_name,e.fullName,e.first_name&&e.last_name?e.first_name+" "+e.last_name:void 0,t.first_name&&t.last_name?t.first_name+" "+t.last_name:void 0),email:n(e.email,t.email,s(o,"email")),phone_number:n(e.phone_number,t.phone_number,e.phone,t.phone,e.phoneNumber,t.phoneNumber,s(l,"number")),mailing_address:n(a(e.mailing_address),a(t.mailing_address),a(e.address),a(t.address),a(s(i)),e.mailing_address,t.mailing_address,e.address,t.address,s(i)),sms_tickets_enabled:n(e.sms_tickets_enabled,t.sms_tickets_enabled),_raw:e}}(t||{});d(i),window.Eventive.renderButtons&&setTimeout(()=>window.Eventive.renderButtons(),100)}}catch(e){console.error("[eventive-account-details] Error fetching account details:",e)}finally{r(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on&&window.Eventive.on("ready",e),e()},[]);const p=()=>{m(null),h("")};if(o)return(0,t.jsx)("div",{className:"eventive-login-container",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"},children:(0,t.jsx)("div",{className:"loader"})});if(!i)return(0,t.jsx)("div",{className:"eventive-notice",style:{textAlign:"center"},children:"Please log in to view your account details."});if(!c)return(0,t.jsx)("div",{className:"eventive-notice",style:{textAlign:"center"},children:"Unable to load account details."});const w={name:"Name",email:"Email",phone_number:"Phone Number",mailing_address:"Mailing Address"};return c&&Object.prototype.hasOwnProperty.call(c,"sms_tickets_enabled")&&(w.sms_tickets_enabled="SMS Tickets Enabled"),(0,t.jsx)("div",{className:"eventive-account-details",children:(0,t.jsxs)("div",{className:"eventive-account-details-content",children:[(0,t.jsx)("h2",{children:"My Account Details"}),(0,t.jsxs)("table",{className:"styled-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Field"}),(0,t.jsx)("th",{children:"Value"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:Object.keys(w).map(e=>{const n=w[e],s=c[e],a=null!=s&&""!==s?s:"Not Set",i="boolean"==typeof a?a?"Yes":"No":a,l=u===e;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:n}),(0,t.jsx)("td",{className:"static-value",children:l?"sms_tickets_enabled"===e?(0,t.jsxs)("select",{value:v,onChange:e=>h(e.target.value),className:"edit-select",children:[(0,t.jsx)("option",{value:"true",children:"Yes"}),(0,t.jsx)("option",{value:"false",children:"No"})]}):(0,t.jsx)("input",{type:"text",value:v,onChange:e=>h(e.target.value),className:"edit-input"}):i}),(0,t.jsx)("td",{children:"sms_tickets_enabled"===e?(0,t.jsxs)("label",{className:"toggle-switch",children:[(0,t.jsx)("input",{type:"checkbox",className:"sms-toggle",checked:!0===a,onChange:e=>(async e=>{try{const t=window.eventivePersonId;if(!t)return;const n={sms_tickets_enabled:e};await window.Eventive.request({method:"POST",path:`people/${t}`,authenticatePerson:!0,data:n}),d({...c,sms_tickets_enabled:e})}catch(e){console.error("[eventive-account-details] Error updating SMS setting:",e)}})(e.target.checked)}),(0,t.jsx)("span",{className:"slider"})]}):l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"submit-row-button",onClick:()=>(async e=>{try{const t=window.eventivePersonId;if(!t)return void alert("Missing person ID");const n={};n[e]=v,await window.Eventive.request({method:"POST",path:`people/${t}`,authenticatePerson:!0,data:n}),d({...c,[e]:v}),m(null),h("")}catch(e){console.error("[eventive-account-details] Error submitting update:",e),alert("Failed to save changes. Please try again.")}})(e),children:"Submit"})," ",(0,t.jsx)("button",{className:"cancel-row-button",onClick:p,children:"Cancel"})]}):(0,t.jsx)("button",{className:"edit-row-button",onClick:()=>((e,t)=>{m(e),h("Not Set"===t?"":t)})(e,i),children:"Edit"})})]},e)})})]}),(0,t.jsx)("div",{className:"eventive-account-actions",style:{marginTop:"16px"},children:(0,t.jsx)("div",{className:"eventive-button","data-payment":"true","data-label":"Manage Payment Details"})})]})})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-details").forEach(n=>{(0,e.createRoot)(n).render((0,t.jsx)(i,{}))})})})();