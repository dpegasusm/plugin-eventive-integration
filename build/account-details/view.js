(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(...e){for(let t=0;t<e.length;t++){const n=e[t];if(null!=n&&""!==n)return n}}function s(e,t){if(!e||!e.length)return;if(!t)return e[0];const n=e[0];return n&&"object"==typeof n?n[t]:n}function a(e){if(!e||"object"!=typeof e)return e;const t=[e.street||e.line1||e.address1,e.line2||e.address2,e.city,e.region||e.state,e.postal_code||e.postalCode||e.zip,e.country].filter(Boolean);return t.length?t.join(", "):void 0}function i(){const[i,o]=(0,e.useState)(!1),[l,c]=(0,e.useState)(!0),[r,d]=(0,e.useState)(null),[v,u]=(0,e.useState)(null),[m,h]=(0,e.useState)("");(0,e.useEffect)(()=>{const e=async()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();if(o(e),e){const e=window.EventiveBlockData?.apiEndpoints||{},t=window.EventiveBlockData?.eventNonce||"",i=await wp.apiFetch({path:`/eventive/v1/${e.people}?self=true&eventive_nonce=${t}`,method:"GET"}),o=i&&(i.person||i);window.eventivePersonId=o&&o.id;const l=function(e){if(!e||"object"!=typeof e)return{};const t=e.details||{},i=e.addresses||t.addresses,o=e.phones||t.phones,l=e.emails||t.emails;return{name:n(e.name,t.name,e.full_name,e.fullName,e.first_name&&e.last_name?e.first_name+" "+e.last_name:void 0,t.first_name&&t.last_name?t.first_name+" "+t.last_name:void 0),email:n(e.email,t.email,s(l,"email")),phone_number:n(e.phone_number,t.phone_number,e.phone,t.phone,e.phoneNumber,t.phoneNumber,s(o,"number")),mailing_address:n(a(e.mailing_address),a(t.mailing_address),a(e.address),a(t.address),a(s(i)),e.mailing_address,t.mailing_address,e.address,t.address,s(i)),sms_tickets_enabled:n(e.sms_tickets_enabled,t.sms_tickets_enabled),_raw:e}}(o||{});d(l),window.Eventive.renderButtons&&setTimeout(()=>window.Eventive.renderButtons(),100)}}catch(e){console.error("Error fetching account details:",e)}finally{c(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on&&window.Eventive.on("ready",e),e()},[]);const p=()=>{u(null),h("")};if(l)return(0,t.jsx)("div",{className:"eventive-login-container",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"},children:(0,t.jsx)("div",{className:"loader"})});if(!i)return(0,t.jsx)("div",{className:"eventive-notice",style:{textAlign:"center"},children:"Please log in to view your account details."});if(!r)return(0,t.jsx)("div",{className:"eventive-notice",style:{textAlign:"center"},children:"Unable to load account details."});const w={name:"Name",email:"Email",phone_number:"Phone Number",mailing_address:"Mailing Address"};return r&&Object.prototype.hasOwnProperty.call(r,"sms_tickets_enabled")&&(w.sms_tickets_enabled="SMS Tickets Enabled"),(0,t.jsx)("div",{className:"eventive-account-details",children:(0,t.jsxs)("div",{className:"eventive-account-details-content",children:[(0,t.jsx)("h2",{children:"My Account Details"}),(0,t.jsxs)("table",{className:"styled-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Field"}),(0,t.jsx)("th",{children:"Value"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:Object.keys(w).map(e=>{const n=w[e],s=r[e],a=null!=s&&""!==s?s:"Not Set",i="boolean"==typeof a?a?"Yes":"No":a,o=v===e;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:n}),(0,t.jsx)("td",{className:"static-value",children:o?"sms_tickets_enabled"===e?(0,t.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"edit-select",children:[(0,t.jsx)("option",{value:"true",children:"Yes"}),(0,t.jsx)("option",{value:"false",children:"No"})]}):(0,t.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),className:"edit-input"}):i}),(0,t.jsx)("td",{children:"sms_tickets_enabled"===e?(0,t.jsxs)("label",{className:"toggle-switch",children:[(0,t.jsx)("input",{type:"checkbox",className:"sms-toggle",checked:!0===a,onChange:e=>(async e=>{try{const t=window.eventivePersonId;if(!t)return;const n=window.EventiveBlockData?.apiEndpoints||{},s=window.EventiveBlockData?.eventNonce||"",a={sms_tickets_enabled:e};await wp.apiFetch({path:`/eventive/v1/${n.people}/${t}?eventive_nonce=${s}`,method:"POST",data:a}),d({...r,sms_tickets_enabled:e})}catch(e){console.error("Error updating SMS setting:",e)}})(e.target.checked)}),(0,t.jsx)("span",{className:"slider"})]}):o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"submit-row-button",onClick:()=>(async e=>{try{const t=window.eventivePersonId;if(!t)return void alert("Missing person ID");const n=window.EventiveBlockData?.apiEndpoints||{},s=window.EventiveBlockData?.eventNonce||"",a={};a[e]=m,await wp.apiFetch({path:`/eventive/v1/${n.people}/${t}?eventive_nonce=${s}`,method:"POST",data:a}),d({...r,[e]:m}),u(null),h("")}catch(e){console.error("Error submitting update:",e),alert("Failed to save changes. Please try again.")}})(e),children:"Submit"})," ",(0,t.jsx)("button",{className:"cancel-row-button",onClick:p,children:"Cancel"})]}):(0,t.jsx)("button",{className:"edit-row-button",onClick:()=>((e,t)=>{u(e),h("Not Set"===t?"":t)})(e,i),children:"Edit"})})]},e)})})]}),(0,t.jsx)("div",{className:"eventive-account-actions",style:{marginTop:"16px"},children:(0,t.jsx)("div",{className:"eventive-button","data-payment":"true","data-label":"Manage Payment Details"})})]})})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-details").forEach(n=>{(0,e.createRoot)(n).render((0,t.jsx)(i,{}))})})})();