(()=>{"use strict";window.wp.element;const e=window.requestIdleCallback||function(e){return setTimeout(function(){e({didTimeout:!0,timeRemaining:function(){return 0}})},50)};function t(e){return(e<10?"0":"")+e}function n(e){return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())}function i(e){const t=new Date(e),n=t.getDay(),i=(0===n?-6:1)-n;return t.setDate(t.getDate()+i),t.setHours(0,0,0,0),t}function a(e){const t=i(e),n=new Date(t);return n.setDate(n.getDate()+6),n.setHours(23,59,59,999),n}function r(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),n}function o(e){return e.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})}function s(e){const t=new Date(e);return t.setHours(0,0,0,0),t}function l(e,t){return+e<+t}function c(e,t){return e?"cover"===t?e.cover_image||e.still_image||e.poster_image||"":"still"===t?e.still_image||e.poster_image||e.cover_image||"":"none"===t?"":e.poster_image||e.cover_image||e.still_image||"":""}function d(e){return e&&(e.image||e.poster_image||e.cover_image||e.still_image||e.film_poster_image||e.film_cover_image||e.film_still_image||e.program_item&&(e.program_item.image||e.program_item.poster_image||e.program_item.cover_image||e.program_item.still_image)||e.tile_image||e.hero_image||e.card_image)||""}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-native-year-round").forEach(t=>{if(t.__inited)return;t.__inited=!0,window.EventiveBlockData;const m=window.EventiveBlockData?.eventBucket||window.EventiveBlockData?.eventBucket||"",u=t.getAttribute("data-image")||"poster",v="true"===t.getAttribute("data-description"),p="true"===t.getAttribute("data-venue"),f="true"===t.getAttribute("data-details"),_=window.EventiveBlockData?.filmDetailBaseURL||"",y=window.EventiveBlockData?.usePrettyPermalinks||!1,g=window.EventiveBlockData?.filmSyncEnabled||!1,w=new Date,h=s(w),b=i(w);let E=i(w),D=a(w),C=new Date(Math.max(+E,+h));const A={},k={};let x={},S=!1,N={};const L=e=>{if(e){if(!M.__spinner){const e=document.createElement("div");e.className="yr-loading",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="24px",e.style.gap="10px",e.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="9" opacity="0.2"/><path d="M21 12a9 9 0 0 0-9-9"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="0.9s" repeatCount="indefinite"/></path></g></svg><span style="font:500 0.95rem/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text-muted, #6b7280);">Loading…</span>',M.__spinner=e}M.contains(M.__spinner)||M.appendChild(M.__spinner),M.setAttribute("aria-busy","true")}else M.__spinner&&M.contains(M.__spinner)&&M.removeChild(M.__spinner),M.removeAttribute("aria-busy")},q=t.querySelector(".eventive-film-loading-text");q&&q.remove();const T=document.createElement("div");T.className="eventive-nyr-calendar-wrap";const I=document.createElement("div");I.className="eventive-nyr-nav",I.innerHTML='\n\t\t\t<div class="eventive-nyr-nav-controls">\n\t\t\t\t<button class="eventive-nyr-btn eventive-nyr-prev" type="button">‹ Prev</button>\n\t\t\t\t<button class="eventive-nyr-btn eventive-nyr-next" type="button">Next ›</button>\n\t\t\t</div>\n\t\t\t<div class="eventive-nyr-buttons"></div>\n\t\t',T.appendChild(I);const M=document.createElement("div");M.className="eventive-nyr-events",T.appendChild(M),t.appendChild(T);const R=I.querySelector(".eventive-nyr-prev"),B=I.querySelector(".eventive-nyr-next"),P=I.querySelector(".eventive-nyr-buttons"),H=()=>{S||(S=!0,requestAnimationFrame(()=>{S=!1,F()}))},O=()=>{let e="";for(let t=0;t<7;t++){const i=r(E,t),a=n(i),c=a===n(C),d=l(s(i),h);e+=`<button class="yr-day-btn ${c?"is-active":""} ${d?"is-disabled":""}" data-day="${a}" type="button" ${d?"disabled":""}>${o(i)}</button>`}P.innerHTML=e,P.querySelectorAll(".yr-day-btn").forEach(e=>{e.addEventListener("click",()=>{if(e.hasAttribute("disabled"))return;const t=e.getAttribute("data-day");C=new Date(t+"T12:00:00"),O(),H()})})},U=e=>{const t=e&&e.film;if(!t)return"#";if(g){const e=t.slug||String(t.name||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");return(_||"").replace(/\/$/,"")+"/"+e}return y?_+"?film-id="+encodeURIComponent(t.id||""):_+"&film-id="+encodeURIComponent(t.id||"")},$=e=>{(e||M).querySelectorAll(".eventive-button[data-event][data-label]").forEach(e=>{const t=e.getAttribute("data-label")||"";if(!t)return;const n=e.querySelector(".eventive__ticket-button__button button span");n&&(n.__evtLabelApplied&&n.textContent===t||(n.textContent=t,n.classList.add("evt-ticket-btn"),n.__evtLabelApplied=!0))})},F=()=>{const t=n(C),i=x&&x[t]||[];if(L(!1),!i.length)return void(M.innerHTML='<div class="yr-no-events">No events this day.</div>');const a={},r=[];i.forEach(e=>{const t=e.venue&&e.venue.id||(e.is_virtual?"virtual":"unknown"),n=e.films&&e.films[0]||e.film||null,i=n&&n.id||"",r=e.name||e.title||n&&(n.name||n.title)||e.display_title||"Untitled",o=t+"::"+(i||r);a[o]||(a[o]={evRef:e,film:n||{},title:r,venueName:e.venue&&(e.venue.name||e.venue.display_name||e.venue.slug)||(e.is_virtual?"Virtual":"TBA"),items:[]}),a[o].items.push({id:e.id,dt:new Date(e.start_time),ev:e})});const o=Object.values(a);o.forEach(e=>{e.items.sort((e,t)=>+e.dt-+t.dt)}),o.sort((e,t)=>+e.items[0].dt-+t.items[0].dt),M.innerHTML="";let s=0,l=!1;const _=()=>{const n=document.createDocumentFragment(),i=Math.min(s+8,o.length);for(;s<i;s++){const e=o[s],t=e.evRef,i="still"===u&&t.films&&t.films[0]?t.films[0]:t.film||t.films&&t.films[0]||{},a=e.title;let l="";if("none"!==u&&(l=c(i,u)||d(t)||""),!l){const e=t.film_id||i&&i.id||t.program_item&&t.program_item.film_id||null;e&&r.push(e)}const m=v&&(t.short_description||t.description||i.short_description||i.description)||"",_=f?U(t):"#",y=document.createElement("article");if(y.className="yr-card yr-card--stack"+(l?" has-media":""),l){const e=document.createElement("div");e.className="yr-card__media";const t=document.createElement("img");t.setAttribute("loading","lazy"),t.setAttribute("decoding","async"),t.alt=a,t.src=l,e.appendChild(t),y.appendChild(e)}const g=document.createElement("div");g.className="yr-card__body";const w=document.createElement("h3");if(w.className="yr-card__title",w.textContent=a,g.appendChild(w),p){const t=document.createElement("div");t.className="yr-card__meta",t.textContent=e.venueName,g.appendChild(t)}if(m){const e=document.createElement("div");e.className="yr-card__desc",e.innerHTML=String(m),g.appendChild(e)}if(f){const e=document.createElement("div");e.className="yr-card__links";const t=document.createElement("a");t.className="yr-more",t.href=_,t.textContent="Details",e.appendChild(t),g.appendChild(e)}y.appendChild(g);const h=document.createElement("div");h.className="yr-card__cta";const b=document.createElement("div");b.className="yr-card__showtimes yr-showtimes-flex",b.style.display="flex",b.style.flexWrap="wrap",b.style.gap="8px 12px",b.style.alignItems="stretch",e.items.forEach(e=>{const t=document.createElement("div");t.className="yr-showtime__btn",t.style.flex="0 1 240px";const n=document.createElement("div");n.className="eventive-button",n.setAttribute("data-event",e.id||""),n.setAttribute("data-label",e.dt.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})),n.setAttribute("data-universal","true"),t.appendChild(n),b.appendChild(t)}),h.appendChild(b),y.appendChild(h),n.appendChild(y)}if(M.appendChild(n),l=!0,s<o.length)requestAnimationFrame(_);else{if(window.Eventive&&"function"==typeof window.Eventive.rebuild&&setTimeout(()=>{window.Eventive.rebuild(),e(()=>{try{$(M)}catch(e){}})},60),window.IntersectionObserver&&window.Eventive&&"function"==typeof window.Eventive.rebuild){const t=new IntersectionObserver(n=>{n.forEach(n=>{if(n.isIntersecting){try{window.Eventive.rebuild(),e(()=>{try{$(n.target)}catch(e){}})}catch(e){}t.unobserve(n.target)}})},{rootMargin:"100px"});M.querySelectorAll(".yr-card").forEach(e=>t.observe(e))}!r.length||N&&N[t]||(N[t]=!0,Promise.all(r.map(e=>(async e=>{if(!e)return null;if(null===k[e])return null;if(k[e]&&k[e].__loaded)return k[e];if(k[e]&&k[e].__pending)return null;k[e]={__pending:!0};const t=t=>(t?(t.__loaded=!0,k[e]=t):k[e]=null,k[e]);try{const n=await window.Eventive.request({method:"GET",path:"films/"+encodeURIComponent(e),authenticatePerson:!0});if(n&&(n.poster_image||n.cover_image||n.still_image))return t(n)}catch(e){}try{const n="event_buckets/"+encodeURIComponent(m)+"/films/"+encodeURIComponent(e);return t(await window.Eventive.request({method:"GET",path:n,authenticatePerson:!0})||null)}catch(e){return t(null)}})(e))).then(()=>{H()}))}};requestAnimationFrame(_),e(()=>{try{$(M)}catch(e){}})},j=async()=>{const e=E,t=D,i=n(e);if(A[i])return void(x=A[i]);L(!0);const a=a=>{if(!Array.isArray(a))return[];const r=[];for(let n=0;n<a.length;n++){const i=a[n];if(!i||!i.start_time)continue;const o=new Date(i.start_time);isNaN(o)||o>=e&&o<=t&&r.push(i)}r.sort((e,t)=>new Date(e.start_time)-new Date(t.start_time));const o=h,l=n(E)===n(b)?r.filter(e=>+s(new Date(e.start_time))>=+o):r,c={};l.forEach(e=>{!e.film_id&&e.film&&e.film.id&&(e.film_id=e.film.id),!e.film_id&&e.films&&e.films[0]&&e.films[0].id&&(e.film_id=e.films[0].id),!e.film_id&&e.program_item&&e.program_item.film_id&&(e.film_id=e.program_item.film_id),!e.film&&e.films&&e.films[0]&&(e.film=e.films[0]),e.film&&!e.film.name&&e.title&&(e.film.name=e.title);const t=n(new Date(e.start_time));(c[t]||(c[t]=[])).push(e)}),x=c,A[i]=c};try{const n=new URLSearchParams;n.append("start_time_gte",new Date(e).toISOString()),n.append("start_time_lte",new Date(t).toISOString()),n.append("include_past_events","true"),n.append("include","film,films,program_item");const i=`event_buckets/${m}/events`,r=await window.Eventive.request({method:"GET",path:i,qs:Object.fromEntries(n),authenticatePerson:!0});a(r&&(r.events||r)||[]),L(!1)}catch(e){console.error("[eventive-native-year-round] Error fetching week events:",e);try{const e=new Date,t=r(e,60),n=new URLSearchParams;n.append("start_time_gte",e.toISOString()),n.append("start_time_lte",t.toISOString());const i=`event_buckets/${m}/events`,o=await window.Eventive.request({method:"GET",path:i,qs:Object.fromEntries(n),authenticatePerson:!0});a(o&&(o.events||o)||[]),L(!1)}catch(e){console.error("[eventive-native-year-round] Fallback fetch failed:",e),x={},L(!1)}}},G=()=>{const e=!l(b,E);R.disabled=e,e?R.classList.add("is-disabled"):R.classList.remove("is-disabled")},z=async e=>{let t=r(E,7*e);l(t,b)&&(t=b),E=t,D=a(E),C=new Date(Math.max(+E,+h)),O();const i=n(E);A[i]?(x=A[i],L(!1),H()):(await j(),H()),G()};R.addEventListener("click",()=>z(-1)),B.addEventListener("click",()=>z(1)),(async()=>{O(),G(),await new Promise(e=>{if(window.Eventive&&"function"==typeof window.Eventive.on)window.Eventive._ready?e():window.Eventive.on("ready",e);else{let t=0;const n=()=>{if(++t>40)return console.error("[eventive-native-year-round] Eventive loader timeout"),void e();window.Eventive&&window.Eventive.on?window.Eventive._ready?e():window.Eventive.on("ready",e):setTimeout(n,125)};n()}}),await j(),H()})()})})})();