(()=>{"use strict";window.wp.element,window.__Eventive_EventCache=window.__Eventive_EventCache||{};let e="",t=!0;function i(e){return null==e||!("false"===(e=String(e).trim().toLowerCase())||"0"===e||"no"===e||"off"===e||""===e)}function n(e){let t=(e||"").replace("#","");return 3===t.length&&(t=t.split("").map(e=>e+e).join("")),(299*(parseInt(t.substr(0,2),16)||0)+587*(parseInt(t.substr(2,2),16)||0)+114*(parseInt(t.substr(4,2),16)||0))/1e3>150?"#000":"#fff"}function s(t){if(!t||"object"!=typeof t)return"";const i=["wp_detail_url","wp_permalink","permalink","detail_url","details_url","url","public_url","site_url"];for(let e=0;e<i.length;e++){const n=t[i[e]];if("string"==typeof n&&n)return n}const n=t.id||t.slug||t.slugified_title;return n&&e?e.replace(/\/+$/,"")+"/?film-id="+encodeURIComponent(n):""}function a(e,t){try{const i=new URL(window.location.href);e?i.searchParams.set("tag-id",e):i.searchParams.delete("tag-id"),"replace"===t?history.replaceState({},"",i.toString()):history.pushState({},"",i.toString())}catch(e){}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-events-list").forEach(r=>{if(r.__inited)return;r.__inited=!0,r.classList.add("eventive-events-list--inited"),window.EventiveBlockData;const o=window.EventiveBlockData?.eventBucket||window.EventiveBlockData?.eventBucket||"",l=parseInt(r.getAttribute("data-limit"))||0,c=r.getAttribute("data-tag-id")||"",d=c?c.split(",").map(e=>e.trim()).filter(Boolean):[],v=r.getAttribute("data-exclude-tags")||"",u=v?v.split(",").map(e=>e.trim()).filter(Boolean):[],m=r.getAttribute("data-venue-id")||"",g=i(r.getAttribute("data-event-description")),f=i(r.getAttribute("data-short-description")),w=r.getAttribute("data-image")||"cover",p="true"===r.getAttribute("data-virtual"),h=i(r.getAttribute("data-show-filter")),E=r.getAttribute("data-view")||"list",_="false"!==r.getAttribute("data-show-undated"),b="true"===r.getAttribute("data-include-past"),y=r.getAttribute("data-start-date")||"",A=r.getAttribute("data-end-date")||"",L=r.getAttribute("data-film-detail-base");L&&!e&&(e=L);const C=r.getAttribute("data-film-detail-pretty");null!==C&&""!==C&&(t="true"===String(C).toLowerCase());let S=(new URLSearchParams(window.location.search).get("tag-id")||"").trim();const k=d[0]||"";let D=null,P=null;if(y){const e=new Date(y);isFinite(e.getTime())&&(D=e.getTime())}if(A){const e=new Date(A);isFinite(e.getTime())&&(e.setHours(23,59,59,999),P=e.getTime())}const T=()=>{if(!h)return;const e=r.querySelector(".eventive-events-tags-filter");if(e)try{const t=e.querySelectorAll(".eventive-tag-btn");t.forEach(e=>{e.classList.remove("active")}),t.forEach(e=>{const t=e.getAttribute("data-tag-id")||"";S?t===S&&e.classList.add("active"):t||e.classList.add("active")})}catch(e){}};let I=[];const N=(e,t)=>{const i=e||I,o=((e,t)=>{const i="string"==typeof t?t:S||k,n=[],s=[];(e||[]).forEach(e=>{if(m&&(!e.venue||e.venue.id!==m))return;if(!p&&e.is_virtual)return;const t=[];i?t.push(String(i)):d&&d.length&&t.push(...d);const a=Array.isArray(e.tags)?e.tags:[],r=e.films&&e.films[0]&&Array.isArray(e.films[0].tags)?e.films[0].tags:[],o=a.concat(r),l=[],c=[];if(o.forEach(e=>{e&&(null!=e.id&&l.push(String(e.id)),e.name&&c.push(e.name.toLowerCase()))}),!t.length||t.some(e=>l.includes(e)||c.includes(e.toLowerCase()))){if((null!=D||null!=P)&&e.start_time){const t=new Date(e.start_time).getTime();if(isFinite(t)){if(null!=D&&t<D)return;if(null!=P&&t>P)return}}if(u&&u.length&&1===o.length){const e=o[0];if(e){const t=null!=e.id?String(e.id):"",i=e.name||"";if(u.some(e=>t&&e===t||i&&e.toLowerCase()===i.toLowerCase()))return}}if(!1===e.is_date||!1===e.is_dated||!e.start_time&&null==e.date){if(!_)return;n.push(e)}else{if(!(e=>{if(b)return!0;const t=e&&e.start_time?new Date(e.start_time).getTime():NaN;return!!isFinite(t)&&t>=Date.now()})(e))return;s.push(e)}}});const a=n.concat(s);return l&&l>0?a.slice(0,l):a})(i,t),c=(e=>{const t=new Map;return e.forEach(e=>{const i=Array.isArray(e.tags)?e.tags:[],n=(Array.isArray(e.films)?e.films:[]).flatMap(e=>Array.isArray(e.tags)?e.tags:[]);i.concat(n).forEach(e=>{if(!e)return;const i=null!=e.id?String(e.id):"",n=e.name||e.title||e.label||(i?"#"+i:"");if(!i&&!n)return;if(u&&u.length&&u.some(e=>i&&e===i||n&&e.toLowerCase()===n.toLowerCase()))return;const s=i||n.toLowerCase();t.has(s)||t.set(s,{id:i,name:n,color:e.color||"#e0e0e0",count:0}),t.get(s).count++})}),Array.from(t.values()).sort((e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1)})(i);(e=>{if(!h||!e.length)return;let t=r.querySelector(".eventive-events-tags-filter");t||(t=document.createElement("div"),t.className="eventive-events-tags-filter",r.insertBefore(t,r.firstChild));const i=`<button class="eventive-tag-btn ${S?"":"active"}" data-tag-id="">All</button>`,s=e.map(e=>{const t=e.color||"#e0e0e0",i=n(t);return`<button class="eventive-tag-btn ${S===e.id||S===e.name?"active":""}" data-tag-id="${e.id||e.name}" style="background-color:${t};color:${i};">${e.name}</button>`}).join("");t.innerHTML=`<div class="eventive-tags-list">${i}${s}</div>`,h||(t.classList.add("is-hidden"),t.setAttribute("hidden",""),t.style.display="none"),t.__evtClickBound||(t.__evtClickBound=!0,t.addEventListener("click",e=>{const t=e.target.closest(".eventive-tag-btn");t&&(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),e.stopPropagation(),S=t.getAttribute("data-tag-id")||"",a(S,"replace"),T(),window.allEventiveEvents&&N(window.allEventiveEvents,S)))},!0))})(c);const v=r.querySelector(".eventive-film-loading-text");v&&v.remove(),r.classList.remove("event-list","event-grid"),r.classList.add("grid"===E?"event-grid":"event-list"),r.innerHTML="grid"===E?(e=>{if(!e.length)return'<p class="no-events">No upcoming events found.</p>';const t=[];return e.forEach(e=>{const i=e.name||"Untitled Event";let n="";if(e.start_time&&!1!==e.is_date){const t=new Date(e.start_time);isNaN(t)||(n=t.toLocaleDateString(void 0,{month:"short",day:"numeric"}))}let s="";"cover"===w?s=e.cover_image||e.images&&e.images.cover||e.films&&e.films[0]&&(e.films[0].cover_image||e.films[0].images&&e.films[0].images.cover)||"":"poster"===w&&(s=e.poster_image||e.images&&e.images.poster||e.films&&e.films[0]&&(e.films[0].poster_image||e.films[0].images&&e.films[0].images.poster)||"");let a='<div class="eventive-card">';s&&(a+='<img class="eventive-card-image" src="'+s+'" alt="'+i+'" />'),a+='<div class="eventive-card-content">',a+='<h4 class="eventive-card-title">'+i+"</h4>",n&&(a+='<p class="eventive-card-meta">'+n+"</p>"),a+=e.hide_tickets_button?"":'<div class="eventive-button" data-event="'+(e.id||"")+'"></div>',a+="</div></div>",t.push(a)}),'<div class="event-grid">'+t.join("")+"</div>"})(o):(e=>{if(!e.length)return'<p class="no-events">No upcoming events found.</p>';const t=[];return e.forEach(e=>{let i="";if(e.start_time&&!1!==e.is_date){const t=new Date(e.start_time);isNaN(t)||(i=t.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}))}const a=e.name||"Untitled Event",r=e.description||"",o=e.short_description||e.films&&e.films[0]&&e.films[0].short_description||"",l=e.venue&&e.venue.name||"No venue specified";let c="";if(e.films&&e.films.length)if(1===e.films.length){const t=s(e.films[0]);t&&(c='<div class="film-meta"><a href="'+t+'">View Film Details</a></div>')}else c='<div class="film-meta">Showing: '+e.films.map(e=>{const t=e.name||e.title||"Untitled",i=s(e);return i?'<a href="'+i+'">'+t+"</a>":t}).join("")+"</div>";let d="";"cover"===w?d=e.cover_image||e.images&&e.images.cover||e.films&&e.films[0]&&(e.films[0].cover_image||e.films[0].images&&e.films[0].images.cover)||"":"poster"===w&&(d=e.poster_image||e.images&&e.images.poster||e.films&&e.films[0]&&(e.films[0].poster_image||e.films[0].images&&e.films[0].images.poster)||"");let v="";if("none"!==w&&d){let t='<div class="poster-container"><img src="'+d+'" alt="'+a+' Image" class="poster" /></div>';if(e.films&&1===e.films.length){const i=s(e.films[0]);i&&(t='<a href="'+i+'">'+t+"</a>")}v=t}const m=e.hide_tickets_button?"":'<div class="eventive-button" data-event="'+(e.id||"")+'"></div>',p=new Map;(e.tags||[]).concat((e.films||[]).flatMap(e=>e.tags||[])).forEach(e=>{if(!e)return;const t=null!=e.id?String(e.id):"",i=e.name||e.title||e.label||(t?"#"+t:"");if(!t&&!i)return;if(u&&u.length&&u.some(e=>t&&e===t||i&&e.toLowerCase()===i.toLowerCase()))return;const n=t||i.toLowerCase();p.has(n)||p.set(n,{id:t,name:i,color:e.color||"#e0e0e0"})});const h=Array.from(p.values()).map(e=>{const t=n(e.color||"#e0e0e0");return'<span class="eventive-tag-pill" style="background-color:'+e.color+";color:"+t+';">'+e.name+"</span>"}).join("");let E='<div class="event-item">';v&&(E+=v),E+='<div class="event-details">',E+='<h3 class="event-name">'+a+"</h3>",i&&(E+='<p class="event-start-time">'+i+"</p>"),E+='<p class="event-venue"><strong>Venue:</strong> '+l+"</p>",c&&(E+=c),f&&o&&(E+='<div class="event-short-description">'+o+"</div>"),g&&r&&(E+='<div class="event-description">'+r+"</div>"),h&&(E+='<div class="eventive-tag-pills">'+h+"</div>"),E+=m,E+="</div></div>",t.push(E)}),t.length?t.join(""):'<p class="no-events">No upcoming events found.</p>'})(o),setTimeout(()=>{r.querySelector(".eventive-button")&&window.Eventive?.rebuild&&window.Eventive.rebuild()},100)};window.allEventiveEvents=window.allEventiveEvents||[],document.addEventListener("eventive:setActiveTag",e=>{const t=e&&e.detail&&void 0!==e.detail.tagId?e.detail.tagId:e.detail||"";S=String(t||""),a(S,"replace"),T(),window.allEventiveEvents&&N(window.allEventiveEvents,S)}),window.addEventListener("popstate",()=>{try{S=new URL(window.location.href).searchParams.get("tag-id")||"",T(),window.allEventiveEvents&&N(window.allEventiveEvents,S)}catch(e){}}),(()=>{if(!window.Eventive)return void(r.innerHTML='<p class="error-message">Eventive API is not initialized. Please check your integration.</p>');let e=!1;const t=()=>{if(e)return;e=!0,window.Eventive&&window.Eventive.off&&window.Eventive.off("ready",t);const i=new URLSearchParams(window.location.search).get("tag-id")||k;(function(e,t){const i=!!(t=t||{}).includePast,n=!!t.includeVirtual,s=!!t.forceAll,a=e+"::past="+(i?1:0)+"::virt="+(n?1:0)+"::all="+(s?1:0),r=window.__Eventive_EventCache;if(r[a])return Promise.resolve(r[a]);if(!window.Eventive)return Promise.reject(new Error("Eventive API is not initialized."));const o={};return i||s||(o.upcoming_only=!0,o.marquee=!0),n&&(o.include_virtual=!0),window.Eventive.request({method:"GET",path:"event_buckets/"+encodeURIComponent(e)+"/events",qs:o,authenticatePerson:!0}).then(e=>{const t=e&&e.events||[];return r[a]=t,r[a]})})(o,{includePast:b,includeVirtual:p,forceAll:_}).then(e=>{I=e,window.allEventiveEvents=e,N(e,i)}).catch(()=>{r.innerHTML='<p class="error-message">Error loading events. Please try again later.</p>'})};window.Eventive._ready||window.Eventive.ready?t():window.Eventive.on("ready",t)})()})})})();