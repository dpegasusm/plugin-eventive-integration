(()=>{"use strict";function t(t){return null==t||!("false"===(t=String(t).trim().toLowerCase())||"0"===t||"no"===t||"off"===t||""===t)}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-events-list").forEach(e=>{window.EventiveBlockData,window.EventiveBlockData;const n=window.EventiveBlockData?.eventBucket||window.EventiveBlockData?.eventBucket||"",i=parseInt(e.getAttribute("data-limit"))||0,a=e.getAttribute("data-tag-id")||"",r=e.getAttribute("data-exclude-tags")||"",s=e.getAttribute("data-venue-id")||"",v=t(e.getAttribute("data-event-description")),o=t(e.getAttribute("data-short-description")),d=e.getAttribute("data-image")||"cover",c="true"===e.getAttribute("data-virtual"),l=t(e.getAttribute("data-show-filter")),m=e.getAttribute("data-view")||"list",u="false"!==e.getAttribute("data-show-undated"),g="true"===e.getAttribute("data-include-past"),f=e.getAttribute("data-start-date")||"",p=e.getAttribute("data-end-date")||"";let w="",A=null,y=null;if(f){const t=new Date(f);isFinite(t.getTime())&&(A=t.getTime())}if(p){const t=new Date(p);isFinite(t.getTime())&&(t.setHours(23,59,59,999),y=t.getTime())}let b=[];const h=()=>{const t=(t=>{let e=[...t];if(a&&(e=e.filter(t=>{const e=Array.isArray(t.tags)?t.tags:[],n=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return e.concat(n).some(t=>t&&String(t.id)===a)})),w&&(e=e.filter(t=>{const e=Array.isArray(t.tags)?t.tags:[],n=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return e.concat(n).some(t=>t&&String(t.id)===w)})),r){const t=r.split(",").map(t=>t.trim());e=e.filter(e=>{const n=Array.isArray(e.tags)?e.tags:[],i=(Array.isArray(e.films)?e.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return!n.concat(i).some(e=>e&&t.includes(String(e.id)))})}if(s&&(e=e.filter(t=>t.venue&&String(t.venue.id)===s)),c||(e=e.filter(t=>!t.is_virtual)),(A||y)&&(e=e.filter(t=>{if(!t.start_time)return u;const e=new Date(t.start_time).getTime();return!(A&&e<A||y&&e>y)})),!g){const t=Date.now();e=e.filter(e=>e.start_time?new Date(e.start_time).getTime()>t:u)}return u||(e=e.filter(t=>t.start_time)),e.sort((t,e)=>t.start_time||e.start_time?t.start_time?e.start_time?new Date(t.start_time).getTime()-new Date(e.start_time).getTime():-1:1:0),i>0&&(e=e.slice(0,i)),e})(b),n=(t=>{const e=new Map;return t.forEach(t=>{const n=Array.isArray(t.tags)?t.tags:[],i=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);n.concat(i).forEach(t=>{if(!t||!t.id)return;const n=String(t.id);e.has(n)||e.set(n,{id:n,name:t.name||"",color:t.color||"#ccc",count:0}),e.get(n).count++})}),Array.from(e.values()).sort((t,e)=>t.name.localeCompare(e.name))})(t);(t=>{if(!l||!t.length)return;let n=e.querySelector(".eventive-events-tags-filter");n||(n=document.createElement("div"),n.className="eventive-events-tags-filter",e.insertBefore(n,e.firstChild));const i=`<button class="eventive-tag-btn ${w?"":"active"}" data-tag-id="">All</button>`,a=t.map(t=>{const e=t.color||"#ccc",n=function(t){let e=(t||"").replace("#","");return 3===e.length&&(e=e.split("").map(t=>t+t).join("")),(299*(parseInt(e.substr(0,2),16)||0)+587*(parseInt(e.substr(2,2),16)||0)+114*(parseInt(e.substr(4,2),16)||0))/1e3>150?"#000":"#fff"}(e);return`<button class="eventive-tag-btn ${w===t.id?"active":""}" data-tag-id="${t.id}" style="background-color:${e};color:${n};">${t.name}</button>`}).join("");n.innerHTML=`<div class="eventive-tags-list">${i}${a}</div>`,n.querySelectorAll(".eventive-tag-btn").forEach(t=>{t.addEventListener("click",()=>{w=t.getAttribute("data-tag-id")||"",h()})})})(n);let f=e.querySelector(".eventive-events-container");var p;f||(f=document.createElement("div"),f.className="eventive-events-container",e.appendChild(f)),f.innerHTML="grid"===m?(p=t).length?`<div class="eventive-events-grid">${p.map(t=>{const e=t.films&&t.films[0],n="poster"===d?e?.poster_image||t.poster_image:e?.cover_image||t.cover_image||e?.poster_image,i=t.start_time?new Date(t.start_time).toLocaleDateString(void 0,{month:"short",day:"numeric"}):"On Demand";return`\n\t\t\t\t\t\t<div class="eventive-event-card">\n\t\t\t\t\t\t\t${n?`<div class="eventive-event-card-image"><img src="${n}" alt="${t.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="eventive-event-card-content">\n\t\t\t\t\t\t\t\t<h4 class="eventive-event-card-title">${t.name||""}</h4>\n\t\t\t\t\t\t\t\t<div class="eventive-event-card-date">${i}</div>\n\t\t\t\t\t\t\t\t<div class="eventive-button" data-event="${t.id}"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-events">No events found.</div>':(t=>t.length?t.map(t=>{const e=t.films&&t.films[0],n="poster"===d?e?.poster_image||t.poster_image:e?.cover_image||t.cover_image||e?.poster_image,i=t.venue?.name||(t.is_virtual?"Virtual":""),a=t.start_time?new Date(t.start_time).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"On Demand",r=o?t.short_description||"":v&&t.description||"";return`\n\t\t\t\t\t\t<div class="eventive-event-item">\n\t\t\t\t\t\t\t${n?`<div class="eventive-event-image"><img src="${n}" alt="${t.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="eventive-event-content">\n\t\t\t\t\t\t\t\t<h3 class="eventive-event-title">${t.name||""}</h3>\n\t\t\t\t\t\t\t\t<div class="eventive-event-meta">\n\t\t\t\t\t\t\t\t\t${a?`<span class="eventive-event-date">${a}</span>`:""}\n\t\t\t\t\t\t\t\t\t${i?`<span class="eventive-event-venue">${i}</span>`:""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t${r?`<div class="eventive-event-description">${r}</div>`:""}\n\t\t\t\t\t\t\t\t<div class="eventive-button" data-event="${t.id}"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join(""):'<div class="eventive-no-events">No events found.</div>')(t),window.Eventive?.rebuild&&window.Eventive.rebuild()};(()=>{const t=()=>{const t=new URLSearchParams;g||(t.append("upcoming_only","true"),t.append("marquee","true")),c&&t.append("include_virtual","true");let i=`event_buckets/${n}/events`;t.toString()&&(i+=`?${t.toString()}`),window.Eventive.request({method:"GET",path:i,authenticatePerson:!1}).then(t=>{b=t&&t.events||[],h()}).catch(t=>{console.error("[eventive-events-list] Error fetching events:",t),e.innerHTML='<div class="eventive-error">Error loading events.</div>'})};window.Eventive&&window.Eventive._ready?t():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",t):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?t():(console.error("[eventive-events-list] Eventive API not available"),e.innerHTML='<div class="eventive-error">Error loading events.</div>')},1e3)})()})})})();