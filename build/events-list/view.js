(()=>{"use strict";function t(t){return null==t||!("false"===(t=String(t).trim().toLowerCase())||"0"===t||"no"===t||"off"===t||""===t)}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-events-list").forEach(e=>{const i=window.EventiveBlockData?.apiEndpoints||{},n=window.EventiveBlockData?.eventNonce||"",a=window.EventiveBlockData?.eventBucket||window.eventiveOptions?.eventBucket||"",r=parseInt(e.getAttribute("data-limit"))||0,s=e.getAttribute("data-tag-id")||"",v=e.getAttribute("data-exclude-tags")||"",o=e.getAttribute("data-venue-id")||"",c=t(e.getAttribute("data-event-description")),d=t(e.getAttribute("data-short-description")),l=e.getAttribute("data-image")||"cover",m="true"===e.getAttribute("data-virtual"),u=t(e.getAttribute("data-show-filter")),g=e.getAttribute("data-view")||"list",p="false"!==e.getAttribute("data-show-undated"),f="true"===e.getAttribute("data-include-past"),A=e.getAttribute("data-start-date")||"",y=e.getAttribute("data-end-date")||"";let w="",b=null,_=null;if(A){const t=new Date(A);isFinite(t.getTime())&&(b=t.getTime())}if(y){const t=new Date(y);isFinite(t.getTime())&&(t.setHours(23,59,59,999),_=t.getTime())}let h=[];const $=()=>{const t=(t=>{let e=[...t];if(s&&(e=e.filter(t=>{const e=Array.isArray(t.tags)?t.tags:[],i=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return e.concat(i).some(t=>t&&String(t.id)===s)})),w&&(e=e.filter(t=>{const e=Array.isArray(t.tags)?t.tags:[],i=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return e.concat(i).some(t=>t&&String(t.id)===w)})),v){const t=v.split(",").map(t=>t.trim());e=e.filter(e=>{const i=Array.isArray(e.tags)?e.tags:[],n=(Array.isArray(e.films)?e.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);return!i.concat(n).some(e=>e&&t.includes(String(e.id)))})}if(o&&(e=e.filter(t=>t.venue&&String(t.venue.id)===o)),m||(e=e.filter(t=>!t.is_virtual)),(b||_)&&(e=e.filter(t=>{if(!t.start_time)return p;const e=new Date(t.start_time).getTime();return!(b&&e<b||_&&e>_)})),!f){const t=Date.now();e=e.filter(e=>e.start_time?new Date(e.start_time).getTime()>t:p)}return p||(e=e.filter(t=>t.start_time)),e.sort((t,e)=>t.start_time||e.start_time?t.start_time?e.start_time?new Date(t.start_time).getTime()-new Date(e.start_time).getTime():-1:1:0),r>0&&(e=e.slice(0,r)),e})(h),i=(t=>{const e=new Map;return t.forEach(t=>{const i=Array.isArray(t.tags)?t.tags:[],n=(Array.isArray(t.films)?t.films:[]).flatMap(t=>Array.isArray(t.tags)?t.tags:[]);i.concat(n).forEach(t=>{if(!t||!t.id)return;const i=String(t.id);e.has(i)||e.set(i,{id:i,name:t.name||"",color:t.color||"#ccc",count:0}),e.get(i).count++})}),Array.from(e.values()).sort((t,e)=>t.name.localeCompare(e.name))})(t);(t=>{if(!u||!t.length)return;let i=e.querySelector(".eventive-events-tags-filter");i||(i=document.createElement("div"),i.className="eventive-events-tags-filter",e.insertBefore(i,e.firstChild));const n=`<button class="eventive-tag-btn ${w?"":"active"}" data-tag-id="">All</button>`,a=t.map(t=>{const e=t.color||"#ccc",i=function(t){let e=(t||"").replace("#","");return 3===e.length&&(e=e.split("").map(t=>t+t).join("")),(299*(parseInt(e.substr(0,2),16)||0)+587*(parseInt(e.substr(2,2),16)||0)+114*(parseInt(e.substr(4,2),16)||0))/1e3>150?"#000":"#fff"}(e);return`<button class="eventive-tag-btn ${w===t.id?"active":""}" data-tag-id="${t.id}" style="background-color:${e};color:${i};">${t.name}</button>`}).join("");i.innerHTML=`<div class="eventive-tags-list">${n}${a}</div>`,i.querySelectorAll(".eventive-tag-btn").forEach(t=>{t.addEventListener("click",()=>{w=t.getAttribute("data-tag-id")||"",$()})})})(i);let n=e.querySelector(".eventive-events-container");var a;n||(n=document.createElement("div"),n.className="eventive-events-container",e.appendChild(n)),n.innerHTML="grid"===g?(a=t).length?`<div class="eventive-events-grid">${a.map(t=>{const e=t.films&&t.films[0],i="poster"===l?e?.poster_image||t.poster_image:e?.cover_image||t.cover_image||e?.poster_image,n=t.start_time?new Date(t.start_time).toLocaleDateString(void 0,{month:"short",day:"numeric"}):"On Demand";return`\n\t\t\t\t\t\t<div class="eventive-event-card">\n\t\t\t\t\t\t\t${i?`<div class="eventive-event-card-image"><img src="${i}" alt="${t.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="eventive-event-card-content">\n\t\t\t\t\t\t\t\t<h4 class="eventive-event-card-title">${t.name||""}</h4>\n\t\t\t\t\t\t\t\t<div class="eventive-event-card-date">${n}</div>\n\t\t\t\t\t\t\t\t<div class="eventive-button" data-event="${t.id}"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-events">No events found.</div>':(t=>t.length?t.map(t=>{const e=t.films&&t.films[0],i="poster"===l?e?.poster_image||t.poster_image:e?.cover_image||t.cover_image||e?.poster_image,n=t.venue?.name||(t.is_virtual?"Virtual":""),a=t.start_time?new Date(t.start_time).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"On Demand",r=d?t.short_description||"":c&&t.description||"";return`\n\t\t\t\t\t\t<div class="eventive-event-item">\n\t\t\t\t\t\t\t${i?`<div class="eventive-event-image"><img src="${i}" alt="${t.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="eventive-event-content">\n\t\t\t\t\t\t\t\t<h3 class="eventive-event-title">${t.name||""}</h3>\n\t\t\t\t\t\t\t\t<div class="eventive-event-meta">\n\t\t\t\t\t\t\t\t\t${a?`<span class="eventive-event-date">${a}</span>`:""}\n\t\t\t\t\t\t\t\t\t${n?`<span class="eventive-event-venue">${n}</span>`:""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t${r?`<div class="eventive-event-description">${r}</div>`:""}\n\t\t\t\t\t\t\t\t<div class="eventive-button" data-event="${t.id}"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join(""):'<div class="eventive-no-events">No events found.</div>')(t),window.Eventive?.rebuild&&window.Eventive.rebuild()};(async()=>{try{const t=new URLSearchParams;f||(t.append("upcoming_only","true"),t.append("marquee","true")),m&&t.append("include_virtual","true"),t.append("eventive_nonce",n);const e=await wp.apiFetch({path:`/eventive/v1/${i.event_buckets}/${a}/events?${t.toString()}`,method:"GET"});h=e&&e.events||[],$()}catch(t){console.error("Error fetching events:",t),e.innerHTML='<div class="eventive-error">Error loading events.</div>'}})()})})})();