(()=>{"use strict";function t(t){if(!t)return"#000";let e=t.replace("#","");return 3===e.length&&(e=e.split("").map(t=>t+t).join("")),(299*(parseInt(e.substr(0,2),16)||0)+587*(parseInt(e.substr(2,2),16)||0)+114*(parseInt(e.substr(4,2),16)||0))/1e3>128?"#000":"#fff"}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-film-guide").forEach(e=>{if(e.__inited)return;e.__inited=!0,window.EventiveBlockData,window.EventiveBlockData;const i=window.EventiveBlockData?.eventBucket||window.eventiveOptions?.eventBucket||"",n=JSON.parse(e.getAttribute("data-include-tags")||"[]"),r=JSON.parse(e.getAttribute("data-exclude-tags")||"[]"),a=e.getAttribute("data-image-type")||"poster_image",s=e.getAttribute("data-view")||"grid",o=(e.getAttribute("data-show-events"),"true"===e.getAttribute("data-show-details")),l="true"===e.getAttribute("data-show-description"),d="true"===e.getAttribute("data-show-tags"),c="true"===e.getAttribute("data-year-round"),v="true"===e.getAttribute("data-show-search");let m="",u="",g=[];const f=()=>{const i=(t=>{let e=[...t];return n.length&&(e=e.filter(t=>(Array.isArray(t.tags)?t.tags:[]).some(t=>n.includes(String(t.id))))),r.length&&(e=e.filter(t=>!(Array.isArray(t.tags)?t.tags:[]).some(t=>r.includes(String(t.id))))),m&&(e=e.filter(t=>(Array.isArray(t.tags)?t.tags:[]).some(t=>String(t.id)===m))),u&&(e=e.filter(t=>{const e=(t.name||"").toLowerCase(),i=(t.description||t.short_description||"").toLowerCase();return e.includes(u)||i.includes(u)})),e.sort((t,e)=>(t.name||"").localeCompare(e.name||"")),e})(g),c=(t=>{const e=new Map;return t.forEach(t=>{(Array.isArray(t.tags)?t.tags:[]).forEach(t=>{if(!t||!t.id)return;const i=String(t.id);e.has(i)||e.set(i,{id:i,name:t.name||"",color:t.color||"#ccc",count:0}),e.get(i).count++})}),Array.from(e.values()).sort((t,e)=>t.name.localeCompare(e.name))})(i);(i=>{let n=e.querySelector(".eventive-film-guide-tags-filter");if(n||(n=document.createElement("div"),n.className="eventive-film-guide-tags-filter",e.insertBefore(n,e.firstChild)),!i.length)return void(n.innerHTML="");const r=`<button class="eventive-tag-btn ${m?"":"active"}" data-tag-id="">All</button>`,a=i.map(e=>{const i=e.color||"#ccc",n=t(i);return`<button class="eventive-tag-btn ${m===e.id?"active":""}" data-tag-id="${e.id}" style="background-color:${i};color:${n};">${e.name}</button>`}).join("");n.innerHTML=`<div class="eventive-tags-list">${r}${a}</div>`,n.querySelectorAll(".eventive-tag-btn").forEach(t=>{t.addEventListener("click",()=>{m=t.getAttribute("data-tag-id")||"",f()})})})(c),(()=>{if(!v)return;let t=e.querySelector(".eventive-film-guide-search");if(!t){t=document.createElement("div"),t.className="eventive-film-guide-search";const i=e.querySelector(".eventive-film-guide-tags-filter");i?i.after(t):e.insertBefore(t,e.firstChild)}t.innerHTML='<input type="search" placeholder="Search films..." class="eventive-search-input" />',t.querySelector(".eventive-search-input").addEventListener("input",t=>{u=t.target.value.toLowerCase(),f()})})();const p=e.querySelector(".eventive-film-loading-text");p&&p.remove();let $=e.querySelector(".eventive-films-container");var h;$||($=document.createElement("div"),$.className="eventive-films-container",e.appendChild($)),$.innerHTML="list"===s?(h=i).length?`<div class="catalog-film-container list">${h.map(e=>{const i=e[a]||e.poster_image||e.cover_image,n=d?(e.tags||[]).map(e=>`<span class="film-tag-pill" style="background-color:${e.color||"#ccc"};color:${t(e.color)};">${e.name}</span>`).join(""):"";return`\n\t\t\t\t\t\t<div class="film-list-item">\n\t\t\t\t\t\t\t${i?`<div class="film-list-image"><img src="${i}" alt="${e.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="film-list-content">\n\t\t\t\t\t\t\t\t<h3 class="film-list-title">${e.name||""}</h3>\n\t\t\t\t\t\t\t\t${l&&e.description?`<div class="film-list-description">${e.description}</div>`:""}\n\t\t\t\t\t\t\t\t${n?`<div class="film-list-tags">${n}</div>`:""}\n\t\t\t\t\t\t\t\t${o?`<div class="film-list-details">\n\t\t\t\t\t\t\t\t\t${e.credits?.director?`<div><strong>Director:</strong> ${e.credits.director}</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.runtime?`<div><strong>Runtime:</strong> ${e.details.runtime} min</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.year?`<div><strong>Year:</strong> ${e.details.year}</div>`:""}\n\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-films">No films found.</div>':(e=>e.length?`<div class="catalog-film-container grid">${e.map(e=>{const i=e[a]||e.poster_image||e.cover_image,n=d?(e.tags||[]).map(e=>`<span class="film-tag-pill" style="background-color:${e.color||"#ccc"};color:${t(e.color)};">${e.name}</span>`).join(""):"";return`\n\t\t\t\t\t\t<div class="film-card">\n\t\t\t\t\t\t\t${i?`<div class="film-card-image"><img src="${i}" alt="${e.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="film-card-content">\n\t\t\t\t\t\t\t\t<h3 class="film-card-title">${e.name||""}</h3>\n\t\t\t\t\t\t\t\t${l&&e.short_description?`<p class="film-card-description">${e.short_description}</p>`:""}\n\t\t\t\t\t\t\t\t${n?`<div class="film-card-tags">${n}</div>`:""}\n\t\t\t\t\t\t\t\t${o?`<div class="film-card-details">\n\t\t\t\t\t\t\t\t\t${e.credits?.director?`<div><strong>Director:</strong> ${e.credits.director}</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.runtime?`<div><strong>Runtime:</strong> ${e.details.runtime} min</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.year?`<div><strong>Year:</strong> ${e.details.year}</div>`:""}\n\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-films">No films found.</div>')(i)};(()=>{const t=()=>{const t=new URLSearchParams;t.append("include","tags"),c&&t.append("marquee","true");let n=`event_buckets/${i}/films`;t.toString()&&(n+=`?${t.toString()}`),window.Eventive.request({method:"GET",path:n,authenticatePerson:!1}).then(t=>{g=t&&t.films||[],f()}).catch(t=>{console.error("[eventive-film-guide] Error fetching films:",t),e.innerHTML='<div class="eventive-error">Error loading films.</div>'})};window.Eventive&&window.Eventive._ready?t():window.Eventive&&"function"==typeof window.Eventive.on?window.Eventive.on("ready",t):setTimeout(()=>{window.Eventive&&"function"==typeof window.Eventive.request?t():(console.error("[eventive-film-guide] Eventive API not available"),e.innerHTML='<div class="eventive-error">Error loading films.</div>')},1e3)})()})})})();