(()=>{"use strict";function t(t){if(!t)return"#000";let e=t.replace("#","");return 3===e.length&&(e=e.split("").map(t=>t+t).join("")),(299*(parseInt(e.substr(0,2),16)||0)+587*(parseInt(e.substr(2,2),16)||0)+114*(parseInt(e.substr(4,2),16)||0))/1e3>128?"#000":"#fff"}window.wp.element,document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-film-guide").forEach(e=>{if(e.__inited)return;e.__inited=!0;const i=window.EventiveBlockData?.apiEndpoints||{},n=window.EventiveBlockData?.eventNonce||"",r=window.EventiveBlockData?.eventBucket||window.eventiveOptions?.eventBucket||"",a=JSON.parse(e.getAttribute("data-include-tags")||"[]"),s=JSON.parse(e.getAttribute("data-exclude-tags")||"[]"),l=e.getAttribute("data-image-type")||"poster_image",o=e.getAttribute("data-view")||"grid",c=(e.getAttribute("data-show-events"),"true"===e.getAttribute("data-show-details")),d="true"===e.getAttribute("data-show-description"),v="true"===e.getAttribute("data-show-tags"),m="true"===e.getAttribute("data-year-round"),g="true"===e.getAttribute("data-show-search");let u="",f="",p=[];const $=()=>{const i=(t=>{let e=[...t];return a.length&&(e=e.filter(t=>(Array.isArray(t.tags)?t.tags:[]).some(t=>a.includes(String(t.id))))),s.length&&(e=e.filter(t=>!(Array.isArray(t.tags)?t.tags:[]).some(t=>s.includes(String(t.id))))),u&&(e=e.filter(t=>(Array.isArray(t.tags)?t.tags:[]).some(t=>String(t.id)===u))),f&&(e=e.filter(t=>{const e=(t.name||"").toLowerCase(),i=(t.description||t.short_description||"").toLowerCase();return e.includes(f)||i.includes(f)})),e.sort((t,e)=>(t.name||"").localeCompare(e.name||"")),e})(p),n=(t=>{const e=new Map;return t.forEach(t=>{(Array.isArray(t.tags)?t.tags:[]).forEach(t=>{if(!t||!t.id)return;const i=String(t.id);e.has(i)||e.set(i,{id:i,name:t.name||"",color:t.color||"#ccc",count:0}),e.get(i).count++})}),Array.from(e.values()).sort((t,e)=>t.name.localeCompare(e.name))})(i);(i=>{let n=e.querySelector(".eventive-film-guide-tags-filter");if(n||(n=document.createElement("div"),n.className="eventive-film-guide-tags-filter",e.insertBefore(n,e.firstChild)),!i.length)return void(n.innerHTML="");const r=`<button class="eventive-tag-btn ${u?"":"active"}" data-tag-id="">All</button>`,a=i.map(e=>{const i=e.color||"#ccc",n=t(i);return`<button class="eventive-tag-btn ${u===e.id?"active":""}" data-tag-id="${e.id}" style="background-color:${i};color:${n};">${e.name}</button>`}).join("");n.innerHTML=`<div class="eventive-tags-list">${r}${a}</div>`,n.querySelectorAll(".eventive-tag-btn").forEach(t=>{t.addEventListener("click",()=>{u=t.getAttribute("data-tag-id")||"",$()})})})(n),(()=>{if(!g)return;let t=e.querySelector(".eventive-film-guide-search");if(!t){t=document.createElement("div"),t.className="eventive-film-guide-search";const i=e.querySelector(".eventive-film-guide-tags-filter");i?i.after(t):e.insertBefore(t,e.firstChild)}t.innerHTML='<input type="search" placeholder="Search films..." class="eventive-search-input" />',t.querySelector(".eventive-search-input").addEventListener("input",t=>{f=t.target.value.toLowerCase(),$()})})();let r=e.querySelector(".eventive-films-container");var m;r||(r=document.createElement("div"),r.className="eventive-films-container",e.appendChild(r)),r.innerHTML="list"===o?(m=i).length?`<div class="catalog-film-container list">${m.map(e=>{const i=e[l]||e.poster_image||e.cover_image,n=v?(e.tags||[]).map(e=>`<span class="film-tag-pill" style="background-color:${e.color||"#ccc"};color:${t(e.color)};">${e.name}</span>`).join(""):"";return`\n\t\t\t\t\t\t<div class="film-list-item">\n\t\t\t\t\t\t\t${i?`<div class="film-list-image"><img src="${i}" alt="${e.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="film-list-content">\n\t\t\t\t\t\t\t\t<h3 class="film-list-title">${e.name||""}</h3>\n\t\t\t\t\t\t\t\t${d&&e.description?`<div class="film-list-description">${e.description}</div>`:""}\n\t\t\t\t\t\t\t\t${n?`<div class="film-list-tags">${n}</div>`:""}\n\t\t\t\t\t\t\t\t${c?`<div class="film-list-details">\n\t\t\t\t\t\t\t\t\t${e.credits?.director?`<div><strong>Director:</strong> ${e.credits.director}</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.runtime?`<div><strong>Runtime:</strong> ${e.details.runtime} min</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.year?`<div><strong>Year:</strong> ${e.details.year}</div>`:""}\n\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-films">No films found.</div>':(e=>e.length?`<div class="catalog-film-container grid">${e.map(e=>{const i=e[l]||e.poster_image||e.cover_image,n=v?(e.tags||[]).map(e=>`<span class="film-tag-pill" style="background-color:${e.color||"#ccc"};color:${t(e.color)};">${e.name}</span>`).join(""):"";return`\n\t\t\t\t\t\t<div class="film-card">\n\t\t\t\t\t\t\t${i?`<div class="film-card-image"><img src="${i}" alt="${e.name||""}" /></div>`:""}\n\t\t\t\t\t\t\t<div class="film-card-content">\n\t\t\t\t\t\t\t\t<h3 class="film-card-title">${e.name||""}</h3>\n\t\t\t\t\t\t\t\t${d&&e.short_description?`<p class="film-card-description">${e.short_description}</p>`:""}\n\t\t\t\t\t\t\t\t${n?`<div class="film-card-tags">${n}</div>`:""}\n\t\t\t\t\t\t\t\t${c?`<div class="film-card-details">\n\t\t\t\t\t\t\t\t\t${e.credits?.director?`<div><strong>Director:</strong> ${e.credits.director}</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.runtime?`<div><strong>Runtime:</strong> ${e.details.runtime} min</div>`:""}\n\t\t\t\t\t\t\t\t\t${e.details?.year?`<div><strong>Year:</strong> ${e.details.year}</div>`:""}\n\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}).join("")}</div>`:'<div class="eventive-no-films">No films found.</div>')(i)};(async()=>{try{const t=new URLSearchParams;t.append("include","tags"),m&&t.append("marquee","true"),t.append("eventive_nonce",n);const e=await wp.apiFetch({path:`/eventive/v1/${i.event_buckets}/${r}/films?${t.toString()}`,method:"GET"});p=e&&e.films||[],$()}catch(t){console.error("Error fetching films:",t),e.innerHTML='<div class="eventive-error">Error loading films.</div>'}})()})})})();